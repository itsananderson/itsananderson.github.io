
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Will Anderson</title>
	<meta name="author" content="Will Anderson">

	
	<meta name="description" content="Update 5/18/2014 This is a 3 year old post, and I&rsquo;ve learned a lot in that time. Using this method to namespace your plugins makes it &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@itsananderson" />
    <meta name="twitter:title" content="Will Anderson" />
    <meta name="twitter:description" content=" Update 5/18/2014 This is a 3 year old post, and I&rsquo;ve learned a lot in that time. Using this method to namespace your plugins makes it difficult to mock dependencies for unit tests. I leave this post up for posterity, but I no longer recommend this design pattern. This evening I was chatting with Nick Ohrn and I threw out an idea that I&rsquo;d been thinking about for a while. What if WordPress plugin developers used PHP static methods to namespace their plugins? An Example Without PHP Static Methods To understand what I&rsquo;m babbling on about, consider a very basic plugin that adds square brackets around post titles. 1
2
3
4
5
6
7
/ * Plugin Name: Add Brackets /
function ab_add_brackets( $title ) { return &quot;[$title]&quot;;
}
add_filter( &#39;the_title&#39;, &#39;ab_add_brackets&#39; ); It really doesn&rsquo;t get much simpler than that, but the problem is that there might be another plugin that uses the same prefix. Also, if you decide to change the prefix, you&rsquo;ll have to go through and change all of your hook and action registrations too. What a pain. Class Namespaces, but no PHP Static Methods The next option is to use a class as a namespacing tool. This is fairly common among more experienced WordPress developers. 1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
/ * Plugin Name: Add Brackets /
if ( !class_exists(&#39;Add_Brackets&#39;) ) { class Add_Brackets { private static $instance; private function __construct() { add_filter( &#39;the_title&#39;, array( $this, &#39;add_brackets&#39; ) ); } public static function get_instance() { if ( null == self::$instance ) { self::$instance = new Add_Brackets(); } return self::$instance; } public function add_brackets( $title ) { return &quot;[$title]&quot;; } } Add_Brackets::get_instance();
} Utilizing PHP Static Methods What I propose is developers use static methods instead. There&rsquo;s very little difference between a singleton class with instance methods and a class with static methods, and simply using static methods can simplify your code. Check out this example. 1
2
3
4
5
6
7
8
9
10
11
12
13
14
/ * Plugin Name: Add Brackets /
if ( !class_exists(&#39;Add_Brackets&#39;) ) { class Add_Brackets { public static function start() { add_filter( &#39;the_title&#39;, array( CLASS, &#39;add_brackets&#39; ) ); } public static function add_brackets( $title ) { return &quot;[$title]&quot;; } } Add_Brackets::start();
} So that&rsquo;s that. All the advantages of namespacing with classes, with a small reduction in memory overhead (because you&rsquo;re passing around strings, rather than objects). Static methods are a PHP5 feature, but with PHP4 support being phased out in WordPress 3.2, this seems like a reasonable next step for WordPress developers to take. What do you think? Are there any issues with this technique that I&rsquo;ve missed? Are there any improvements that could be made? Let me know in the comments! Apr 26th, 2011 WordPress " />

	<link href="http://william-backend.azurewebsites.net/feed/" rel="alternate" title="Will Anderson" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Will Anderson</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/work-with-me">Work With Me</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/work-with-me">Work With Me</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:willi.am">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/itsananderson" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/itsananderson" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="http://william-backend.azurewebsites.net/feed/" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:willi.am">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/04/26/php-static-methods-in-wordpress-plugins/">
		
			PHP Static Methods in WordPress Plugins</a>
	</h2>
	<div class="entry-content">
		<p><p style="background-color: #faa; padding: 5px">
<strong>Update 5/18/2014 This is a 3 year old post, and I&rsquo;ve learned a lot in that time. Using this method to namespace your plugins makes it difficult to mock dependencies for unit tests. I leave this post up for posterity, but I no longer recommend this design pattern.</strong><p></p>

<p>This evening I was chatting with Nick Ohrn and I threw out an idea that I&rsquo;d been thinking about for a while. What if WordPress plugin developers used PHP static methods to namespace their plugins?</p>

<h2>An Example Without PHP Static Methods</h2>

<p>To understand what I&rsquo;m babbling on about, consider a very basic plugin that adds square brackets around post titles.</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cm">/<em></span>
</span><span class='line'><span class="cm"> * Plugin Name: Add Brackets</span>
</span><span class='line'><span class="cm"> </em>/</span>
</span><span class='line'><span class="k">function</span> <span class="nf">ab_add_brackets</span><span class="p">(</span> <span class="nv">$title</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="s2">&quot;[</span><span class="si">$title</span><span class="s2">]&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">add_filter</span><span class="p">(</span> <span class="s1">&#39;the_title&#39;</span><span class="p">,</span> <span class="s1">&#39;ab_add_brackets&#39;</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>It really doesn&rsquo;t get much simpler than that, but the problem is that there might be another plugin that uses the same prefix. Also, if you decide to change the prefix, you&rsquo;ll have to go through and change all of your hook and action registrations too. What a pain.</p>

<h2>Class Namespaces, but no PHP Static Methods</h2>

<p>The next option is to use a class as a namespacing tool. This is fairly common among more experienced WordPress developers.</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cm">/<em></span>
</span><span class='line'><span class="cm"> * Plugin Name: Add Brackets</span>
</span><span class='line'><span class="cm"> </em>/</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">class_exists</span><span class="p">(</span><span class="s1">&#39;Add_Brackets&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Add_Brackets</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">private</span> <span class="k">static</span> <span class="nv">$instance</span><span class="p">;</span>
</span><span class='line'>        <span class="k">private</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">add_filter</span><span class="p">(</span> <span class="s1">&#39;the_title&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span> <span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;add_brackets&#39;</span> <span class="p">)</span> <span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">get_instance</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span> <span class="k">null</span> <span class="o">==</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$instance</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="nv">$instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Add_Brackets</span><span class="p">();</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$instance</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">function</span> <span class="nf">add_brackets</span><span class="p">(</span> <span class="nv">$title</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="s2">&quot;[</span><span class="si">$title</span><span class="s2">]&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">Add_Brackets</span><span class="o">::</span><span class="na">get_instance</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<h2>Utilizing PHP Static Methods</h2>

<p>What I propose is developers use static methods instead. There&rsquo;s very little difference between a singleton class with instance methods and a class with static methods, and simply using static methods can simplify your code. Check out this example.</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cm">/<em></span>
</span><span class='line'><span class="cm"> * Plugin Name: Add Brackets</span>
</span><span class='line'><span class="cm"> </em>/</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">class_exists</span><span class="p">(</span><span class="s1">&#39;Add_Brackets&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Add_Brackets</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">start</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">add_filter</span><span class="p">(</span> <span class="s1">&#39;the_title&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span> <span class="nx"><strong>CLASS</strong></span><span class="p">,</span> <span class="s1">&#39;add_brackets&#39;</span> <span class="p">)</span> <span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">add_brackets</span><span class="p">(</span> <span class="nv">$title</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="s2">&quot;[</span><span class="si">$title</span><span class="s2">]&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">Add_Brackets</span><span class="o">::</span><span class="na">start</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>So that&rsquo;s that. All the advantages of namespacing with classes, with a small reduction in memory overhead (because you&rsquo;re passing around strings, rather than objects). Static methods are a PHP5 feature, but with PHP4 support being phased out in WordPress 3.2, this seems like a reasonable next step for WordPress developers to take.</p>

<p>What do you think? Are there any issues with this technique that I&rsquo;ve missed? Are there any improvements that could be made? Let me know in the comments!</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-04-26T13:16:52-07:00" pubdate data-updated="true">Apr 26<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/wordpress/'>WordPress</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/04/16/wordcamp-seattle-slides-2011/">
		
			WordCamp Seattle Slides 2011</a>
	</h2>
	<div class="entry-content">
		<p>Here are my WordCamp Seattle slides, along with my code samples.</p>

<p>The slides are available as a PDF <a href="http://www.itsananderson.com/wcsea.pdf" title="">here</a>.</p>

<p>The WP_Ajax class is available as a zip file <a href="http://www.itsananderson.com/wp-content/uploads/wp-ajax.zip" title="">here</a>.</p>

<p>The Simple Post Ratings plugin is available (also as a zip file) <a href="http://www.itsananderson.com/wp-content/uploads/simple-post-ratings.zip">here</a>.</p>

<p>Here&rsquo;s a link to my WordCamp Seattle video on <a href="http://wordpress.tv/2011/05/06/will-anderson-using-ajax-in-plugins-and-themes/">WordPress.tv</a>.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-04-16T13:28:00-07:00" pubdate data-updated="true">Apr 16<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/wordpress/'>WordPress</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/02/24/creating-xampp-alias-directories/">
		
			Creating XAMPP Alias Directories</a>
	</h2>
	<div class="entry-content">
		<p>If you&rsquo;ve read my post on <a href="/blog/2009/01/14/wamp-alias-directories/">adding aliases to WampServer</a>,
you may be curious about how to add aliases to XAMPP.
While WampServer has a nice (if somewhat buggy) tool for adding Apache aliases, XAMPP does not.
Fortunately, creating XAMPP alias directories by hand is pretty easy.</p>

<h2>Preparing to Create XAMPP Alias Directories</h2>

<p>The first thing you&rsquo;ll want to do is add an alias directory to your XAMPP install.
If you&rsquo;re running Windows, create the following folder.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>C:\xampp\apache\conf\alias</span></code></pre></td></tr></table></div></figure>


<p>Next, you&rsquo;ll need to change your Apache configuration file.
You can find it under <code>C:\xampp\apache\conf\httpd.conf</code>.
To make changes, you&rsquo;ll need to edit it as an administrator.
If you&rsquo;re running Windows Vista or above, your best bet is to open Notepad as an administrator and then open httpd.conf.
To open Notepad (or any other application) as an administrator, right-click on it and select &ldquo;Run as administrator&rdquo;.
You can also launch Notepad as an administrator from the start menu with <code>Ctrl+Shift+Enter</code> while Notepad is selected.</p>

<p>Once you&rsquo;ve opened httpd.conf, add the following to the end and save it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Include "conf/alias/*"</span></code></pre></td></tr></table></div></figure>


<p>Now Apache will look in the alias folder for more configuration files.
This way you can add an alias by simply adding a new configuration file to the conf/alias/ folder.</p>

<h2>Creating XAMPP Alias Directories</h2>

<p>Let&rsquo;s add some XAMPP alias directories.
Suppose you want to add an alias called &ldquo;dev&rdquo;.
First, download <a href="/uploads/xampp-alias-template.txt">this alias template file</a> and place it in the alias folder.
Rename it to &ldquo;dev.conf&rdquo; (or whatever you called your alias).
You&rsquo;ll need to edit the template (again, as an administrator) and replace &ldquo;DIRECTORY&rdquo; (it&rsquo;s there twice) with the path to the alias and &ldquo;ALIAS&rdquo; with the name of your alias.
In our example, it looks something like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;directory "c:\users\foo\programming\dev"&gt;
</span><span class='line'>    #
</span><span class='line'>    # Possible values for the Options directive are "None", "All",
</span><span class='line'>    # or any combination of:
</span><span class='line'>    #   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews
</span><span class='line'>    #
</span><span class='line'>    # Note that "MultiViews" must be named *explicitly* --- "Options All"
</span><span class='line'>    # doesn't give it to you.
</span><span class='line'>    #
</span><span class='line'>    # The Options directive is both complicated and important.  Please see
</span><span class='line'>    # http://httpd.apache.org/docs/2.2/mod/core.html#options
</span><span class='line'>    # for more information.
</span><span class='line'>    #
</span><span class='line'>    Options Indexes FollowSymLinks Includes ExecCGI
</span><span class='line'>
</span><span class='line'>    #
</span><span class='line'>    # AllowOverride controls what directives may be placed in .htaccess files.
</span><span class='line'>    # It can be "All", "None", or any combination of the keywords:
</span><span class='line'>    #   Options FileInfo AuthConfig Limit
</span><span class='line'>    #
</span><span class='line'>    AllowOverride All
</span><span class='line'>
</span><span class='line'>    #
</span><span class='line'>    # Controls who can get stuff from this server.
</span><span class='line'>    #     Order allow,deny
</span><span class='line'>    Allow from all
</span><span class='line'>&lt;/Directory&gt;
</span><span class='line'>
</span><span class='line'>Alias /dev "C:\users\foo\programming\dev"</span></code></pre></td></tr></table></div></figure>


<p>Restart Apache (you can do so from the XAMPP control panel) and check out <a href="http://localhost/dev.">http://localhost/dev.</a>
You can repeat this process with other aliases to add more XAMPP alias directories.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-02-24T12:35:42-08:00" pubdate data-updated="true">Feb 24<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/apache/'>Apache</a>, <a class='category' href='/blog/categories/xampp/'>XAMPP</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/02/19/wordpress-custom-post-statuses/">
		
			WordPress Custom Post Statuses</a>
	</h2>
	<div class="entry-content">
		<p>WordPress displays post states on post list tables to indicate that a post has a special condition. It&rsquo;s possible to hook into that list of states and a WordPress custom post status. If you want to make certain posts stand out, or need a custom way to categorize your posts, this is simple way to do it.</p>

<p>The following screenshot illustrates some of the default post states.</p>

<p><img src="//itsananderson.blob.core.windows.net/post-images/wordpress-post-status-samples.png" alt="Before adding WordPress Custom Post Statuses" /></p>

<h2>Adding a new WordPress Custom Post Status</h2>

<p>Adding your own states is actually pretty easy. The following code snippet should get you going in the right direction.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">class</span> <span class="nc">My_Custom_Post_State</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">function</span> <span class="nf">My_Custom_Post_State</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">__construct</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">add_filter</span><span class="p">(</span> <span class="s1">&#39;display_post_states&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span> <span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;custom_post_state&#39;</span> <span class="p">)</span> <span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">function</span> <span class="nf">custom_post_state</span><span class="p">(</span> <span class="nv">$states</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">global</span> <span class="nv">$post</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$show_custom_state</span> <span class="o">=</span> <span class="k">null</span> <span class="o">!==</span> <span class="nx">get_post_meta</span><span class="p">(</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">ID</span><span class="p">,</span> <span class="s1">&#39;_some_costom_field&#39;</span> <span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span> <span class="nv">$show_custom_state</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nv">$states</span><span class="p">[]</span> <span class="o">=</span> <span class="nx">__</span><span class="p">(</span> <span class="s1">&#39;Custom State&#39;</span> <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nv">$states</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">new</span> <span class="nx">My_Custom_Post_State</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Result of Adding a WordPress Custom Post Status</h2>

<p>Assuming you have code elsewhere that is adding the custom field to posts, you&rsquo;ll see something like this.</p>

<p><img src="//itsananderson.blob.core.windows.net/post-images/custom-state-sample.png" alt="After Adding WordPress Custom Post Statuses" /></p>

<p>If you added code to add a custom field called <code>_some_custom_field</code> to certain posts, those posts would show up with the &lsquo;Custom State&rsquo; status. You could further customize this example to check the value of the custom meta field, and change the post status based on that field.</p>

<p>That&rsquo;s pretty much it. Obviously there are more useful examples, but this should be enough to get you started.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-02-19T12:59:07-08:00" pubdate data-updated="true">Feb 19<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/wordpress/'>WordPress</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/02/07/time-honored-destiny/">
		
			Time Honored Destiny</a>
	</h2>
	<div class="entry-content">
		<p>Part of my Science Fiction course requires me to write a flash fiction. It turned out well enough that I&rsquo;m not embarrassed to let people read it, so here it is.</p>

<blockquote>

<p style="text-align: center; font-weight: bold;">Time Honored Destiny</p>

It had been four months since the event. Four months of hell. If Thomas hadn&#8217;t started his project years before the outbreak, he would have given up weeks ago. The world had been shocked by how quickly the sickness spread. Thomas didn&#8217;t have time to be shocked. He just kept working. Before the sickness everyone had told him time travel wasn&#8217;t possible. They tried to convince him that he was wasting his time. He wondered how their opinion might change if they knew that his work might be the salvation of the human race.

&#8220;It&#8217;s finally ready.&#8221; Thomas glanced at John, the only other person immune to the sickness. He was glad to have a companion to listen to his ramblings but wished it was someone who could respond. John was completely paralyzed. His body was so horribly disfigured it was almost unrecognizable as human. Thomas had found him a week after the first outbreak while looking for supplies at a nearby hospital. At first he&#8217;d thought the disfigurement was some strange manifestation of the sickness, but the hospital records said he&#8217;d been in a bus accident. He had never been identified by the hospital, so Thomas christened him John Doe. At the time he&#8217;d laughed at the generic name and promised to come up with something better, but with all of his creativity being poured into his work he never had the time.

The machine only had room for Thomas, but if he was successful he would change history for both of them. John had been crippled before the outbreak, but by changing the past, Thomas could at least ensure he&#8217;d receive the medical attention he needed.

Trembling with excitement, Thomas calibrated the machine to place him across the street from the CDC headquarters in Atlanta. He gave himself a month before the initial outbreak. Surely that would be enough time to prevent the world&#8217;s doom. All they had to do was find patient zero. By seizing one improperly sanitized needle from a washed up heroin junkie they could prevent the end of humanity.

&#8220;Wish me luck.&#8221; He murmured. The countdown commenced. 3&#8230;2&#8230;1&#8230;

After a few instants he immerged, dizzy and disoriented. He spotted the entrance to the CDC and stepped into the street. In his excitement he didn&#8217;t even see the bus as it raced toward him.
</blockquote>


<p>That&rsquo;s it. Whatcha think?</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-02-07T19:51:46-08:00" pubdate data-updated="true">Feb 7<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/rose-hulman/'>Rose-Hulman</a>, <a class='category' href='/blog/categories/writing/'>Writing</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2011/01/28/php-code-completion-for-globals/">
		
			PHP Code Completion for Globals</a>
	</h2>
	<div class="entry-content">
		<p>Any IDE worth using provides code completion suggestions as you type. For example, this is what Netbeans suggests when you type &ldquo;wp_&rdquo; inside a WordPress project.</p>

<p><img src="//itsananderson.blob.core.windows.net/post-images/netbeans-code-completion.png" alt="" /></p>

<p>The problem with dynamically typed languages like PHP is that it can be difficult for the IDE to provide PHP code completion for variables that have been defined in the global scope. You can help your IDE by providing it with hints about the types of objects.</p>

<h2>Concrete PHP Code Completion Example</h2>

<p>The example I&rsquo;ll use is the $wpdb global variable defined in WordPress. It contains an instance of the &ldquo;wpdb&rdquo; class, which wraps around the database connection and provides a bunch of helper methods. It&rsquo;s defined in the global scope, so when you use it in another file, your IDE has no clue what type it is. This means it can&rsquo;t provide any PHP code completion.</p>

<p>If you add the following code snippet to the beginning of your function (or file, if applicable), it will tell your IDE the type of the $wpdb variable without actually affecting the execution of your code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">if</span> <span class="p">(</span> <span class="k">false</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$wpdb</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">wpdb</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, the code inside the if statement will never execute, but every IDE I&rsquo;ve ever used isn&rsquo;t smart enough to figure that out, so they assume the type of the $wpdb variable is now wpdb.</p>

<p>When you add the snippet, you get PHP code completion suggestions that look something like this:</p>

<p><img src="//itsananderson.blob.core.windows.net/post-images/netbeans-globals-code-completion.png" alt="" /></p>

<p>The nice thing about doing this is that if you forget to remove the code snippet, it won&rsquo;t break anything. You&rsquo;ll lose a CPU cycle or two evaluating the if statement, but your code will run without any problems. It&rsquo;s probably a good idea to remove it before you release your code, though, since it might be confusing to anyone who looks at it later.</p>

<p><strong>Update</strong>: You can also do this with PHPDoc.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @var $wpdb wpdb</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">global</span> <span class="nv">$wpdb</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This also gives your IDE a hint about what type $wpdb has, and doesn&rsquo;t polute your code with a bunch of non-executing statements.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-01-28T19:57:07-08:00" pubdate data-updated="true">Jan 28<span>th</span>, 2011</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/php/'>PHP</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2010/12/13/even-smarter-post-formats/">
		
			Even Smarter Post Formats</a>
	</h2>
	<div class="entry-content">
		<p><a href="http://dougal.gunters.org/">Dougal Campbell</a> published <a href="http://dougal.gunters.org/blog/2010/12/10/smarter-post-formats">an article</a> the other day suggesting that the way many themes are handling the new Post Formats feature is wrong. While I completely agree that Post Formats shouldn&rsquo;t be handled with giant if/else blocks, I&rsquo;m not sure the proposed solution is the best option either. Here&rsquo;s why.</p>

<p>What Dougal suggests is that theme developers instead dynamically include another template file to handle the post format. I&rsquo;ve seen a similar idea suggested in a <a href="http://core.trac.wordpress.org/ticket/15385">Trac ticket</a>, and the issue I saw (but neglected to comment on) there is the same one I see here. Including PHP files is a relatively expensive operation.</p>

<p>Now, admittedly, including files isn&rsquo;t the worst thing you can do, and WordPress already includes dozens of files for every page request. Still, that doesn&rsquo;t mean you shouldn&rsquo;t try to get as much performance out of your theme as possible. On an average page load on an average website, using the <code>get_template_part()</code> method for Post Formats will cause 10 additional includes, but what happens if the blog admin decides they want to display 50 posts per page? The solution doesn&rsquo;t scale very well.</p>

<p>The alternate solution I propose is to dynamically call functions via <a href="http://www.php.net/manual/en/function.call-user-func.php">call_user_func</a>. When the name of a function is passed to <code>call_user_func</code>, that function is invoked. Incidentally, that&rsquo;s actually how WordPress does function callbacks for its actions and filters.</p>

<p>Here&rsquo;s how the code might look.</p>

<p>First, in your functions.php file, define functions for the Post Formats you wish to support. You could also place them in a separate file (like formats.php for example) and include that from your functions.php. That way you can keep your logic separated from your display, while only adding one additional include instead of ten.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">function</span> <span class="nf">format_aside</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Code to display an aside post</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">function</span> <span class="nf">format_gallery</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Code to display a gallery post</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">function</span> <span class="nf">format_standard</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Code to display a standard post</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, in your template, use the post format to determine which function to call. To make your theme more robust, make sure the post format is supported before you try to call the function. If it isn&rsquo;t, call your backup &ldquo;default&rdquo; format function.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">while</span> <span class="p">(</span> <span class="nx">the_loop</span><span class="p">()</span> <span class="p">)</span><span class="o">:</span>
</span><span class='line'>    <span class="nv">$format</span> <span class="o">=</span> <span class="nx">get_post_format</span><span class="p">();</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span> <span class="nb">function_exists</span><span class="p">(</span> <span class="s1">&#39;format_&#39;</span> <span class="o">.</span> <span class="nv">$format</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">call_user_func</span><span class="p">(</span> <span class="s1">&#39;format_&#39;</span> <span class="o">.</span> <span class="nv">$format</span> <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">call_user_func</span><span class="p">(</span> <span class="s1">&#39;format_standard&#39;</span> <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="k">endwhile</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-12-13T20:54:19-08:00" pubdate data-updated="true">Dec 13<span>th</span>, 2010</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/wordpress/'>WordPress</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2010/03/29/customizing-the-p2-wordpress-theme/">
		
			Customizing the P2 WordPress Theme</a>
	</h2>
	<div class="entry-content">
		<p>As you may have seen, I launched a new blog about a week and a half ago to track how much sleep I&rsquo;m getting. I think tracking my sleeping patterns has helped me get more rest, but that&rsquo;s not really what this post is about.</p>

<p>I thought it might be interesting to talk about some of the customizations I made to the <a href="http://wordpress.org/extend/themes/p2">P2 WordPress theme</a> that I&rsquo;m using.</p>

<p>True to the WordPress paradigm, I didn&rsquo;t actually change anything in the P2 theme, but rather wrote a plugin to modify its behavior with filters and actions.</p>

<p>The most visible change I made was the addition of a &ldquo;Sleep Counter&rdquo; widget that displays the number of hours and minutes I&rsquo;ve slept since March 18th. This actually relies on the the other parts of the plugin, though, so I&rsquo;ll leave the discussion of this widget until later.</p>

<p>The main purpose of this customization is to keep track of the hours I&rsquo;ve slept programmatically. I could have done this with post meta values, but that would defeat the purpose of P2 because I&rsquo;d have to go into the back end to create posts. Instead, I decided to simply put the information in the post and parse it using the <code>wp_insert_post</code> action.</p>

<p>This hook is called whenever a post is saved, right after it has been written to the database. The function is passed the ID of the post that has been created/edited. What I do is get the post content, parse it to find the number of hours/minutes recorded, and save those values to two post metas (or update the post metas if I&rsquo;m editing the post). The function is as follows.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">function</span> <span class="nf">get_sleep_times</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nv">$post</span> <span class="o">=</span> <span class="nx">get_post</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_content</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$matches</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>  <span class="c1">// pretty lazy regex matching here, but it works</span>
</span><span class='line'>  <span class="nv">$matched</span> <span class="o">=</span> <span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/hours[^0123456789]*([0-9]*).*minutes[^0123456789]*([0-9]*)/i&#39;</span><span class="p">,</span> <span class="nv">$content</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nv">$matched</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// don&#39;t do anything if no sleep counts were posted.</span>
</span><span class='line'>      <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$hours</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>  <span class="nv">$minutes</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span><span class='line'>  <span class="nx">update_post_meta</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;_sleep_hours&#39;</span><span class="p">,</span> <span class="nv">$hours</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">update_post_meta</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;_sleep_minutes&#39;</span><span class="p">,</span> <span class="nv">$minutes</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This code isn&rsquo;t perfect, but since I wrote it after about 24 hours without sleep and it is only intended to be used  by myself, I&rsquo;ll give myself a break.</p>

<p>The next step was to create the widget to display my total sleep count. I hadn&rsquo;t created any widgets since the new widget API was released in WordPress 2.8, but a great <a href="http://justintadlock.com/archives/2009/05/26/the-complete-guide-to-creating-widgets-in-wordpress-28">article by Justin Tadlock</a> set me on the right track. I added some customization options for how the sleep count is displayed, but the more interesting part is the function that actually displays the widget. It gets the options for the widget, then calls a <code>print_sleep_count</code> function that I defined.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">function</span> <span class="nf">print_sleep_count</span><span class="p">(</span><span class="nv">$format</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">global</span> <span class="nv">$wpdb</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$ajax</span> <span class="o">=</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$format</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$format</span> <span class="o">=</span> <span class="nv">$format</span> <span class="o">?</span> <span class="nv">$format</span> <span class="o">:</span> <span class="nx">SleepCounterWidget</span><span class="o">::</span><span class="nv">$default_format</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&quot;SELECT COALESCE(SUM(meta_value), 0) as totalsum FROM </span><span class="si">{</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">postmeta</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="o">.</span>
</span><span class='line'>          <span class="s2">&quot;INNER JOIN </span><span class="si">{</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">posts</span><span class="si">}</span><span class="s2"> ON </span><span class="si">{</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">postmeta</span><span class="si">}</span><span class="s2">.post_id = </span><span class="si">{</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">posts</span><span class="si">}</span><span class="s2">.ID &quot;</span> <span class="o">.</span>
</span><span class='line'>          <span class="s2">&quot;WHERE </span><span class="si">{</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">posts</span><span class="si">}</span><span class="s2">.post_status &lt;&gt; &#39;trash&#39; AND </span><span class="si">{</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">postmeta</span><span class="si">}</span><span class="s2">.meta_key = &#39;%s&#39;&quot;</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nv">$hours</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">get_var</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="s1">&#39;_sleep_hours&#39;</span><span class="p">)));</span>
</span><span class='line'>  <span class="nv">$minutes</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">get_var</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="s1">&#39;_sleep_minutes&#39;</span><span class="p">)));</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nb">printf</span><span class="p">(</span><span class="nv">$format</span><span class="p">,</span> <span class="nv">$hours</span> <span class="o">+</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$minutes</span> <span class="o">/</span> <span class="mi">60</span><span class="p">),</span> <span class="nv">$minutes</span> <span class="o">%</span> <span class="mi">60</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">// exit if this is requested via AJAX</span>
</span><span class='line'>  <span class="c1">// if we don&#39;t, WordPress will add &#39;0&#39; to the output</span>
</span><span class='line'>  <span class="o">!</span><span class="nv">$ajax</span> <span class="k">or</span> <span class="k">die</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll notice some funky stuff with the <code>$ajax</code> variable. I&rsquo;ll explain that later. Just ignore it for now.</p>

<p>The main magic here is the the SQL query. I decided to use a SQL query instead of the post meta API because I wanted get an aggregate of the post metas, and doing the aggregation from within SQL is much more efficient. I built a customizable query so I could use it to get both the number of hours slept and the number of minutes slept. I use sprintf to insert the meta key I&rsquo;m looking for when I send the query to <code>$wpdb</code>. The reason I decided against the $wpdb->prepare() function is efficiency. The result would have been the same, but that function does some argument escaping that isn&rsquo;t necessary because I know exactly what variables I&rsquo;m passing in.</p>

<p>Once I get the total number of hours and minutes I&rsquo;ve slept, I convert it to actual hours and minutes. This takes care of the situation where the sum of minutes is greater than 60 (one hour).</p>

<p>The final enhancement I made was some front end AJAX that updates the widget value whenever I create a new post. It&rsquo;s pretty basic, and just utilizes the <a href="http://codex.wordpress.org/AJAX_in_Plugins">Admin AJAX API</a> available within WordPress. The way I decided to do it was to utilize my existing <code>print_sleep_count</code> function. I simply hooked to an AJAX request event. That&rsquo;s where the <code>$ajax</code> variable I mentioned earlier comes in. If the format argument isn&rsquo;t passed to <code>print_sleep_count</code>, I assume it is being called via AJAX and exit at the end of the function.</p>

<p>You&rsquo;ll also notice that I&rsquo;ve got a widget on my main website that displays the same sleep count. It is mostly identical to the one on my Sleep blog, but the database tables are hard coded (because here <code>$wpdb-&gt;tablename</code> uses the wrong prefix). I also decided to have the sleep count link to my Sleep blog.</p>

<p>And that&rsquo;s pretty much it. There are some enhancements I could probably make. For one thing, I could store the sleep count as one option in the options table to save myself from having to calculate an aggregate value every time, but with the number of visits I get each day, it&rsquo;s not enough of an issue to worry about.</p>

<p>If you&rsquo;d like to see what the rest of the plugin looks like, you can <a href="http://itsananderson.com/download/sleep-counter.1.0.zip">download it</a> and check it out.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-03-29T22:00:35-07:00" pubdate data-updated="true">Mar 29<span>th</span>, 2010</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/wordpress/'>WordPress</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2010/03/14/netbeans-ftp-file-permissions-fix/">
		
			Netbeans FTP File Permissions Fix</a>
	</h2>
	<div class="entry-content">
		<p>I&rsquo;ve been trying out Netbeans&#8217; &ldquo;PHP Application from Remote Server&rdquo; feature this weekend. The idea is that when you save a file, it uploads that file to a remote server where it can be run.</p>

<p>The problem I ran into is that when Netbeans uploads that file and overwrites the old version, the permissions on the file change. I did some searching and it sounds like Netbeans doesn&rsquo;t set permissions on the file, which means it just takes the server default. This doesn&rsquo;t make much sense (should keep permissions of previous file) and for me it meant that the permissions were set so low that I couldn&rsquo;t run the PHP scripts I was uploading.</p>

<p>It&rsquo;s simple enough to change the permissions on those files.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>chmod -R 777 /path/to/files
</span></code></pre></td></tr></table></div></figure>


<p>But you have to run this command <em>every</em> time you make a change. This is a royal pain when you&rsquo;re making a lot of small changes (like when you&rsquo;re trying to track down a bug for example).</p>

<p>One solution might be to try hooking into the ftp server daemon to run that command every time something is committed, but that sounded like too much work. I came up with a better solution.</p>

<p>Instead, I decided to just run that command in a loop. The following scripts runs infinitely (until execution is stopped) and waits 1 second, then runs the permission command.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="k">while</span> <span class="o">(</span><span class="nb">true</span><span class="o">)</span>; <span class="k">do</span>
</span><span class='line'><span class="k">    </span>sleep 1
</span><span class='line'>    chmod -R 777 /path/to/files
</span><span class='line'><span class="k">done</span>;
</span></code></pre></td></tr></table></div></figure>


<p>If you want to be able to do anything else in the command line while this is running, it&rsquo;s probably a good idea to run it in a screen.</p>

<p>Also, you can end the execution of this script with CTRL+C. Otherwise it will continue executing forever.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-03-14T22:04:51-07:00" pubdate data-updated="true">Mar 14<span>th</span>, 2010</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/netbeans/'>Netbeans</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2010/03/12/wordpress-installation-script/">
		
			WordPress Installation Script</a>
	</h2>
	<div class="entry-content">
		<p>The WordPress installation process is already incredibly simple, but because I often find myself setting up fresh installations of WordPress for various reasons, I decided to make it even easier.</p>

<p>The following script takes a folder name as an argument, creates that folder in the website root (specified in a config variable of the script), downloads and extracts the latest version of WordPress into that folder, and runs the WordPress install. Finally, it sets the admin password to the password specified in another config variable and removes the password change nag.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># configuration</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nv">rootURL</span><span class="o">=</span><span class="s2">&quot;http://localhost&quot;</span> <span class="c"># your root URL. No trailing slash</span>
</span><span class='line'><span class="nv">rootDIR</span><span class="o">=</span><span class="s2">&quot;/home/anderswc/public_html&quot;</span> <span class="c"># your document root. No trailing slash</span>
</span><span class='line'>
</span><span class='line'><span class="nv">dbname</span><span class="o">=</span><span class="s2">&quot;wordpress&quot;</span>
</span><span class='line'><span class="nv">dbuser</span><span class="o">=</span><span class="s2">&quot;username&quot;</span>
</span><span class='line'><span class="nv">dbpass</span><span class="o">=</span><span class="s2">&quot;password&quot;</span>
</span><span class='line'><span class="nv">dbhost</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">wppass</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="c">#password to use for the admin account</span>
</span><span class='line'><span class="nv">adminemail</span><span class="o">=</span><span class="s2">&quot;email@example.com&quot;</span> <span class="c">#email to use for the admin account</span>
</span><span class='line'><span class="nv">blogtitle</span><span class="o">=</span><span class="nv">$1</span> <span class="c"># defaults to the specified directory name. can be anything</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$1&quot;</span> <span class="o">]</span>
</span><span class='line'><span class="k">then</span>
</span><span class='line'>  <span class="c"># directory name must be specified</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;Please specify an installation folder name&quot;</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'>  <span class="c"># ideally you shouldn&#39;t have to change anything past this point</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;Creating a WordPress instance in $rootDIR/$1&quot;</span>
</span><span class='line'>  <span class="c"># create the directory to install WordPress in</span>
</span><span class='line'>  mkdir <span class="nv">$rootDIR</span>/<span class="nv">$1</span>
</span><span class='line'>  <span class="c"># download the latest version of WordPress into the directory we just created</span>
</span><span class='line'>  wget -o /dev/null -O <span class="nv">$rootDIR</span>/<span class="nv">$1</span>/wordpress.zip http://wordpress.org/latest.zip
</span><span class='line'>  <span class="c"># unzip the archive containing WordPress. files will be inside a &#39;wordpress&#39; directory</span>
</span><span class='line'>  unzip -q <span class="nv">$rootDIR</span>/<span class="nv">$1</span>/wordpress.zip -d <span class="nv">$rootDIR</span>/<span class="nv">$1</span>
</span><span class='line'>  <span class="c"># move the files out of the &#39;wordpress&#39; directory into their intended location</span>
</span><span class='line'>  mv <span class="nv">$rootDIR</span>/<span class="nv">$1</span>/wordpress/* <span class="nv">$rootDIR</span>/<span class="nv">$1</span>
</span><span class='line'>  <span class="c"># remove the wordpress archive and the wordpress folder</span>
</span><span class='line'>  rm <span class="nv">$rootDIR</span>/<span class="nv">$1</span>/wordpress.zip
</span><span class='line'>  rmdir <span class="nv">$rootDIR</span>/<span class="nv">$1</span>/wordpress
</span><span class='line'>  <span class="c"># make WordPress directory writeable by PHP so installation can take place</span>
</span><span class='line'>  chmod -R 777 <span class="nv">$rootDIR</span>/<span class="nv">$1</span>
</span><span class='line'>  <span class="c"># request the configuration file generation and blog installation webpages.</span>
</span><span class='line'>  <span class="nv">postdata</span><span class="o">=</span><span class="s2">&quot;dbname=$dbname&amp;uname=$dbuser&amp;pwd=$dbpass&amp;dbhost=$dbhost&amp;prefix=$1_&quot;</span>
</span><span class='line'>  wget -o /dev/null --post-data <span class="s2">&quot;$postdata&quot;</span> <span class="s2">&quot;$rootURL/$1/wp-admin/setup-config.php?step=2&quot;</span>
</span><span class='line'>  <span class="nv">postdata</span><span class="o">=</span><span class="s2">&quot;weblog_title=$blogtitle&amp;admin_email=$adminemail&quot;</span>
</span><span class='line'>  wget -o /dev/null --post-data <span class="s2">&quot;$postdata&quot;</span> <span class="s2">&quot;$rootURL/$1/wp-admin/install.php?step=2&quot;</span>
</span><span class='line'>  <span class="c"># WordPress password was randomly generated</span>
</span><span class='line'>  <span class="c"># change it to password in configuration and remove password change nag</span>
</span><span class='line'>  <span class="nv">sqlcommand</span><span class="o">=</span><span class="s2">&quot;UPDATE $1_users SET user_pass=MD5(&#39;$wppass&#39;)&quot;</span>
</span><span class='line'>  <span class="nv">sqlcommand</span><span class="o">=</span><span class="s2">&quot;$sqlcommand;DELETE FROM $1_usermeta WHERE meta_key=&#39;default_password_nag&#39;;&quot;</span>
</span><span class='line'>  mysql -u <span class="nv">$dbuser</span> -p<span class="nv">$dbpass</span> -e <span class="s2">&quot;$sqlcommand&quot;</span> <span class="nv">$dbname</span>
</span><span class='line'>  <span class="c"># uncomment the following line if you&#39;re running this script on a public server</span>
</span><span class='line'>  <span class="c">#chmod -R 755 $rootDIR/$1</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;Done&quot;</span>
</span><span class='line'><span class="k">fi</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you think this might be useful, give it a shot and let me know what you think.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-03-12T21:08:59-08:00" pubdate data-updated="true">Mar 12<span>th</span>, 2010</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/wordpress/'>WordPress</a>


</div>
	
</div>
</article>

<nav id="pagenavi">
    
        <a href="/blog/page/6/" class="prev">Prev</a>
    
    
        <a href="/blog/page/8/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2016

    Will Anderson

</footer>
	<script src="/javascripts/slash.js"></script>





<!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {};
  _dcs.account = '7508815';
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true;
    dc.src = '//tag.getdrip.com/7508815.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6776456-2', 'willi.am');
  ga('send', 'pageview');

</script>

</body>
</html>