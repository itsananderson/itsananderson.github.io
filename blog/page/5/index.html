
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Will Anderson</title>
	<meta name="author" content="Will Anderson">

	
	<meta name="description" content="Dougal Campbell published an article the other day suggesting that the way many themes are handling the new Post Formats feature is wrong. While I &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Will Anderson" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">Will Anderson</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/plugins">WordPress Plugins</a></li>
	<li><a href="/node-modules">Node Modules</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/plugins">WordPress Plugins</a></li>
	<li><a href="/node-modules">Node Modules</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:willi.am">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/itsananderson" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/itsananderson" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:willi.am">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2010/12/13/even-smarter-post-formats/">
		
			Even Smarter Post Formats</a>
	</h2>
	<div class="entry-content">
		<p><a href="http://dougal.gunters.org/">Dougal Campbell</a> published <a href="http://dougal.gunters.org/blog/2010/12/10/smarter-post-formats">an article</a> the other day suggesting that the way many themes are handling the new Post Formats feature is wrong. While I completely agree that Post Formats shouldn&rsquo;t be handled with giant if/else blocks, I&rsquo;m not sure the proposed solution is the best option either. Here&rsquo;s why.</p>

<p>What Dougal suggests is that theme developers instead dynamically include another template file to handle the post format. I&rsquo;ve seen a similar idea suggested in a <a href="http://core.trac.wordpress.org/ticket/15385">Trac ticket</a>, and the issue I saw (but neglected to comment on) there is the same one I see here. Including PHP files is a relatively expensive operation.</p>

<p>Now, admittedly, including files isn&rsquo;t the worst thing you can do, and WordPress already includes dozens of files for every page request. Still, that doesn&rsquo;t mean you shouldn&rsquo;t try to get as much performance out of your theme as possible. On an average page load on an average website, using the <code>get_template_part()</code> method for Post Formats will cause 10 additional includes, but what happens if the blog admin decides they want to display 50 posts per page? The solution doesn&rsquo;t scale very well.</p>

<p>The alternate solution I propose is to dynamically call functions via <a href="http://www.php.net/manual/en/function.call-user-func.php">call_user_func</a>. When the name of a function is passed to <code>call_user_func</code>, that function is invoked. Incidentally, that&rsquo;s actually how WordPress does function callbacks for its actions and filters.</p>

<p>Here&rsquo;s how the code might look.</p>

<p>First, in your functions.php file, define functions for the Post Formats you wish to support. You could also place them in a separate file (like formats.php for example) and include that from your functions.php. That way you can keep your logic separated from your display, while only adding one additional include instead of ten.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">function</span> <span class="nf">format_aside</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Code to display an aside post</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">function</span> <span class="nf">format_gallery</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Code to display a gallery post</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">function</span> <span class="nf">format_standard</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Code to display a standard post</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, in your template, use the post format to determine which function to call. To make your theme more robust, make sure the post format is supported before you try to call the function. If it isn&rsquo;t, call your backup &ldquo;default&rdquo; format function.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">while</span> <span class="p">(</span> <span class="nx">the_loop</span><span class="p">()</span> <span class="p">)</span><span class="o">:</span>
</span><span class='line'>    <span class="nv">$format</span> <span class="o">=</span> <span class="nx">get_post_format</span><span class="p">();</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span> <span class="nb">function_exists</span><span class="p">(</span> <span class="s1">&#39;format_&#39;</span> <span class="o">.</span> <span class="nv">$format</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">call_user_func</span><span class="p">(</span> <span class="s1">&#39;format_&#39;</span> <span class="o">.</span> <span class="nv">$format</span> <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">call_user_func</span><span class="p">(</span> <span class="s1">&#39;format_standard&#39;</span> <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="k">endwhile</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-12-13T20:54:19-08:00" pubdate data-updated="true">Dec 13<span>th</span>, 2010</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/wordpress/'>WordPress</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2010/03/29/customizing-the-p2-wordpress-theme/">
		
			Customizing the P2 WordPress Theme</a>
	</h2>
	<div class="entry-content">
		<p>As you may have seen, I launched a new blog about a week and a half ago to track how much sleep I&rsquo;m getting. I think tracking my sleeping patterns has helped me get more rest, but that&rsquo;s not really what this post is about.</p>

<p>I thought it might be interesting to talk about some of the customizations I made to the <a href="http://wordpress.org/extend/themes/p2">P2 WordPress theme</a> that I&rsquo;m using.</p>

<p>True to the WordPress paradigm, I didn&rsquo;t actually change anything in the P2 theme, but rather wrote a plugin to modify its behavior with filters and actions.</p>

<p>The most visible change I made was the addition of a &ldquo;Sleep Counter&rdquo; widget that displays the number of hours and minutes I&rsquo;ve slept since March 18th. This actually relies on the the other parts of the plugin, though, so I&rsquo;ll leave the discussion of this widget until later.</p>

<p>The main purpose of this customization is to keep track of the hours I&rsquo;ve slept programmatically. I could have done this with post meta values, but that would defeat the purpose of P2 because I&rsquo;d have to go into the back end to create posts. Instead, I decided to simply put the information in the post and parse it using the <code>wp_insert_post</code> action.</p>

<p>This hook is called whenever a post is saved, right after it has been written to the database. The function is passed the ID of the post that has been created/edited. What I do is get the post content, parse it to find the number of hours/minutes recorded, and save those values to two post metas (or update the post metas if I&rsquo;m editing the post). The function is as follows.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">function</span> <span class="nf">get_sleep_times</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nv">$post</span> <span class="o">=</span> <span class="nx">get_post</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_content</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$matches</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>  <span class="c1">// pretty lazy regex matching here, but it works</span>
</span><span class='line'>  <span class="nv">$matched</span> <span class="o">=</span> <span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/hours[^0123456789]*([0-9]*).*minutes[^0123456789]*([0-9]*)/i&#39;</span><span class="p">,</span> <span class="nv">$content</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nv">$matched</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">// don&#39;t do anything if no sleep counts were posted.</span>
</span><span class='line'>      <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$hours</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>  <span class="nv">$minutes</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span><span class='line'>  <span class="nx">update_post_meta</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;_sleep_hours&#39;</span><span class="p">,</span> <span class="nv">$hours</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">update_post_meta</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="s1">&#39;_sleep_minutes&#39;</span><span class="p">,</span> <span class="nv">$minutes</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This code isn&rsquo;t perfect, but since I wrote it after about 24 hours without sleep and it is only intended to be used  by myself, I&rsquo;ll give myself a break.</p>

<p>The next step was to create the widget to display my total sleep count. I hadn&rsquo;t created any widgets since the new widget API was released in WordPress 2.8, but a great <a href="http://justintadlock.com/archives/2009/05/26/the-complete-guide-to-creating-widgets-in-wordpress-28">article by Justin Tadlock</a> set me on the right track. I added some customization options for how the sleep count is displayed, but the more interesting part is the function that actually displays the widget. It gets the options for the widget, then calls a <code>print_sleep_count</code> function that I defined.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">function</span> <span class="nf">print_sleep_count</span><span class="p">(</span><span class="nv">$format</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">global</span> <span class="nv">$wpdb</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$ajax</span> <span class="o">=</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$format</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$format</span> <span class="o">=</span> <span class="nv">$format</span> <span class="o">?</span> <span class="nv">$format</span> <span class="o">:</span> <span class="nx">SleepCounterWidget</span><span class="o">::</span><span class="nv">$default_format</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&quot;SELECT COALESCE(SUM(meta_value), 0) as totalsum FROM </span><span class="si">{</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">postmeta</span><span class="si">}</span><span class="s2"> &quot;</span> <span class="o">.</span>
</span><span class='line'>          <span class="s2">&quot;INNER JOIN </span><span class="si">{</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">posts</span><span class="si">}</span><span class="s2"> ON </span><span class="si">{</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">postmeta</span><span class="si">}</span><span class="s2">.post_id = </span><span class="si">{</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">posts</span><span class="si">}</span><span class="s2">.ID &quot;</span> <span class="o">.</span>
</span><span class='line'>          <span class="s2">&quot;WHERE </span><span class="si">{</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">posts</span><span class="si">}</span><span class="s2">.post_status &lt;&gt; &#39;trash&#39; AND </span><span class="si">{</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">postmeta</span><span class="si">}</span><span class="s2">.meta_key = &#39;%s&#39;&quot;</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nv">$hours</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">get_var</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="s1">&#39;_sleep_hours&#39;</span><span class="p">)));</span>
</span><span class='line'>  <span class="nv">$minutes</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$wpdb</span><span class="o">-&gt;</span><span class="na">get_var</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="s1">&#39;_sleep_minutes&#39;</span><span class="p">)));</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nb">printf</span><span class="p">(</span><span class="nv">$format</span><span class="p">,</span> <span class="nv">$hours</span> <span class="o">+</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$minutes</span> <span class="o">/</span> <span class="mi">60</span><span class="p">),</span> <span class="nv">$minutes</span> <span class="o">%</span> <span class="mi">60</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">// exit if this is requested via AJAX</span>
</span><span class='line'>  <span class="c1">// if we don&#39;t, WordPress will add &#39;0&#39; to the output</span>
</span><span class='line'>  <span class="o">!</span><span class="nv">$ajax</span> <span class="k">or</span> <span class="k">die</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You&rsquo;ll notice some funky stuff with the <code>$ajax</code> variable. I&rsquo;ll explain that later. Just ignore it for now.</p>

<p>The main magic here is the the SQL query. I decided to use a SQL query instead of the post meta API because I wanted get an aggregate of the post metas, and doing the aggregation from within SQL is much more efficient. I built a customizable query so I could use it to get both the number of hours slept and the number of minutes slept. I use sprintf to insert the meta key I&rsquo;m looking for when I send the query to <code>$wpdb</code>. The reason I decided against the $wpdb->prepare() function is efficiency. The result would have been the same, but that function does some argument escaping that isn&rsquo;t necessary because I know exactly what variables I&rsquo;m passing in.</p>

<p>Once I get the total number of hours and minutes I&rsquo;ve slept, I convert it to actual hours and minutes. This takes care of the situation where the sum of minutes is greater than 60 (one hour).</p>

<p>The final enhancement I made was some front end AJAX that updates the widget value whenever I create a new post. It&rsquo;s pretty basic, and just utilizes the <a href="http://codex.wordpress.org/AJAX_in_Plugins">Admin AJAX API</a> available within WordPress. The way I decided to do it was to utilize my existing <code>print_sleep_count</code> function. I simply hooked to an AJAX request event. That&rsquo;s where the <code>$ajax</code> variable I mentioned earlier comes in. If the format argument isn&rsquo;t passed to <code>print_sleep_count</code>, I assume it is being called via AJAX and exit at the end of the function.</p>

<p>You&rsquo;ll also notice that I&rsquo;ve got a widget on my main website that displays the same sleep count. It is mostly identical to the one on my Sleep blog, but the database tables are hard coded (because here <code>$wpdb-&gt;tablename</code> uses the wrong prefix). I also decided to have the sleep count link to my Sleep blog.</p>

<p>And that&rsquo;s pretty much it. There are some enhancements I could probably make. For one thing, I could store the sleep count as one option in the options table to save myself from having to calculate an aggregate value every time, but with the number of visits I get each day, it&rsquo;s not enough of an issue to worry about.</p>

<p>If you&rsquo;d like to see what the rest of the plugin looks like, you can <a href="http://itsananderson.com/download/sleep-counter.1.0.zip">download it</a> and check it out.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-03-29T22:00:35-07:00" pubdate data-updated="true">Mar 29<span>th</span>, 2010</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/wordpress/'>WordPress</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2010/03/14/netbeans-ftp-file-permissions-fix/">
		
			Netbeans FTP File Permissions Fix</a>
	</h2>
	<div class="entry-content">
		<p>I&rsquo;ve been trying out Netbeans&#8217; &ldquo;PHP Application from Remote Server&rdquo; feature this weekend. The idea is that when you save a file, it uploads that file to a remote server where it can be run.</p>

<p>The problem I ran into is that when Netbeans uploads that file and overwrites the old version, the permissions on the file change. I did some searching and it sounds like Netbeans doesn&rsquo;t set permissions on the file, which means it just takes the server default. This doesn&rsquo;t make much sense (should keep permissions of previous file) and for me it meant that the permissions were set so low that I couldn&rsquo;t run the PHP scripts I was uploading.</p>

<p>It&rsquo;s simple enough to change the permissions on those files.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>chmod -R 777 /path/to/files
</span></code></pre></td></tr></table></div></figure>


<p>But you have to run this command <em>every</em> time you make a change. This is a royal pain when you&rsquo;re making a lot of small changes (like when you&rsquo;re trying to track down a bug for example).</p>

<p>One solution might be to try hooking into the ftp server daemon to run that command every time something is committed, but that sounded like too much work. I came up with a better solution.</p>

<p>Instead, I decided to just run that command in a loop. The following scripts runs infinitely (until execution is stopped) and waits 1 second, then runs the permission command.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="k">while</span> <span class="o">(</span><span class="nb">true</span><span class="o">)</span>; <span class="k">do</span>
</span><span class='line'><span class="k">    </span>sleep 1
</span><span class='line'>    chmod -R 777 /path/to/files
</span><span class='line'><span class="k">done</span>;
</span></code></pre></td></tr></table></div></figure>


<p>If you want to be able to do anything else in the command line while this is running, it&rsquo;s probably a good idea to run it in a screen.</p>

<p>Also, you can end the execution of this script with CTRL+C. Otherwise it will continue executing forever.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-03-14T22:04:51-07:00" pubdate data-updated="true">Mar 14<span>th</span>, 2010</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/netbeans/'>Netbeans</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2010/03/12/wordpress-installation-script/">
		
			WordPress Installation Script</a>
	</h2>
	<div class="entry-content">
		<p>The WordPress installation process is already incredibly simple, but because I often find myself setting up fresh installations of WordPress for various reasons, I decided to make it even easier.</p>

<p>The following script takes a folder name as an argument, creates that folder in the website root (specified in a config variable of the script), downloads and extracts the latest version of WordPress into that folder, and runs the WordPress install. Finally, it sets the admin password to the password specified in another config variable and removes the password change nag.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># configuration</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="nv">rootURL</span><span class="o">=</span><span class="s2">&quot;http://localhost&quot;</span> <span class="c"># your root URL. No trailing slash</span>
</span><span class='line'><span class="nv">rootDIR</span><span class="o">=</span><span class="s2">&quot;/home/anderswc/public_html&quot;</span> <span class="c"># your document root. No trailing slash</span>
</span><span class='line'>
</span><span class='line'><span class="nv">dbname</span><span class="o">=</span><span class="s2">&quot;wordpress&quot;</span>
</span><span class='line'><span class="nv">dbuser</span><span class="o">=</span><span class="s2">&quot;username&quot;</span>
</span><span class='line'><span class="nv">dbpass</span><span class="o">=</span><span class="s2">&quot;password&quot;</span>
</span><span class='line'><span class="nv">dbhost</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">wppass</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="c">#password to use for the admin account</span>
</span><span class='line'><span class="nv">adminemail</span><span class="o">=</span><span class="s2">&quot;email@example.com&quot;</span> <span class="c">#email to use for the admin account</span>
</span><span class='line'><span class="nv">blogtitle</span><span class="o">=</span><span class="nv">$1</span> <span class="c"># defaults to the specified directory name. can be anything</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$1&quot;</span> <span class="o">]</span>
</span><span class='line'><span class="k">then</span>
</span><span class='line'>  <span class="c"># directory name must be specified</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;Please specify an installation folder name&quot;</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'>  <span class="c"># ideally you shouldn&#39;t have to change anything past this point</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;Creating a WordPress instance in $rootDIR/$1&quot;</span>
</span><span class='line'>  <span class="c"># create the directory to install WordPress in</span>
</span><span class='line'>  mkdir <span class="nv">$rootDIR</span>/<span class="nv">$1</span>
</span><span class='line'>  <span class="c"># download the latest version of WordPress into the directory we just created</span>
</span><span class='line'>  wget -o /dev/null -O <span class="nv">$rootDIR</span>/<span class="nv">$1</span>/wordpress.zip http://wordpress.org/latest.zip
</span><span class='line'>  <span class="c"># unzip the archive containing WordPress. files will be inside a &#39;wordpress&#39; directory</span>
</span><span class='line'>  unzip -q <span class="nv">$rootDIR</span>/<span class="nv">$1</span>/wordpress.zip -d <span class="nv">$rootDIR</span>/<span class="nv">$1</span>
</span><span class='line'>  <span class="c"># move the files out of the &#39;wordpress&#39; directory into their intended location</span>
</span><span class='line'>  mv <span class="nv">$rootDIR</span>/<span class="nv">$1</span>/wordpress/* <span class="nv">$rootDIR</span>/<span class="nv">$1</span>
</span><span class='line'>  <span class="c"># remove the wordpress archive and the wordpress folder</span>
</span><span class='line'>  rm <span class="nv">$rootDIR</span>/<span class="nv">$1</span>/wordpress.zip
</span><span class='line'>  rmdir <span class="nv">$rootDIR</span>/<span class="nv">$1</span>/wordpress
</span><span class='line'>  <span class="c"># make WordPress directory writeable by PHP so installation can take place</span>
</span><span class='line'>  chmod -R 777 <span class="nv">$rootDIR</span>/<span class="nv">$1</span>
</span><span class='line'>  <span class="c"># request the configuration file generation and blog installation webpages.</span>
</span><span class='line'>  <span class="nv">postdata</span><span class="o">=</span><span class="s2">&quot;dbname=$dbname&amp;uname=$dbuser&amp;pwd=$dbpass&amp;dbhost=$dbhost&amp;prefix=$1_&quot;</span>
</span><span class='line'>  wget -o /dev/null --post-data <span class="s2">&quot;$postdata&quot;</span> <span class="s2">&quot;$rootURL/$1/wp-admin/setup-config.php?step=2&quot;</span>
</span><span class='line'>  <span class="nv">postdata</span><span class="o">=</span><span class="s2">&quot;weblog_title=$blogtitle&amp;admin_email=$adminemail&quot;</span>
</span><span class='line'>  wget -o /dev/null --post-data <span class="s2">&quot;$postdata&quot;</span> <span class="s2">&quot;$rootURL/$1/wp-admin/install.php?step=2&quot;</span>
</span><span class='line'>  <span class="c"># WordPress password was randomly generated</span>
</span><span class='line'>  <span class="c"># change it to password in configuration and remove password change nag</span>
</span><span class='line'>  <span class="nv">sqlcommand</span><span class="o">=</span><span class="s2">&quot;UPDATE $1_users SET user_pass=MD5(&#39;$wppass&#39;)&quot;</span>
</span><span class='line'>  <span class="nv">sqlcommand</span><span class="o">=</span><span class="s2">&quot;$sqlcommand;DELETE FROM $1_usermeta WHERE meta_key=&#39;default_password_nag&#39;;&quot;</span>
</span><span class='line'>  mysql -u <span class="nv">$dbuser</span> -p<span class="nv">$dbpass</span> -e <span class="s2">&quot;$sqlcommand&quot;</span> <span class="nv">$dbname</span>
</span><span class='line'>  <span class="c"># uncomment the following line if you&#39;re running this script on a public server</span>
</span><span class='line'>  <span class="c">#chmod -R 755 $rootDIR/$1</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;Done&quot;</span>
</span><span class='line'><span class="k">fi</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you think this might be useful, give it a shot and let me know what you think.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-03-12T21:08:59-08:00" pubdate data-updated="true">Mar 12<span>th</span>, 2010</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/wordpress/'>WordPress</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2009/05/21/multiple-wordpress-blogs-on-one-wordpress-core/">
		
			Multiple WordPress Blogs on One WordPress Core</a>
	</h2>
	<div class="entry-content">
		<p>Last Saturday I had the opportunity to listen to <a href="http://www.krotscheck.net/">Mike Krotscheck</a> talk about techniques for advanced WordPress installations. One of the most interesting things I took away from his talk was a way to install multiple WordPress blogs on one WordPress core. Note we&rsquo;re not talking about WordPress MU. When you only need 2 or 3 blogs, WordPress MU can be a bit overkill, but installing these blogs on the same WordPress core can save space and make updates easier. Here&rsquo;s how you do it.</p>

<p>First of course you need to download WordPress and then upload it to your server. This is the easy part, and there are lots of instructions for how to do this, so I won&rsquo;t go through them. You&rsquo;ll also need a MySQL database, but again I won&rsquo;t go into that since there are lots of resources already available that explain how to do this.</p>

<p>Let&rsquo;s suppose we&rsquo;re installing two blogs on domain1.com and domain2.com (lame I know, but give me a break). These should be pointing at the same server (your domain registrar can help you with this). If you navigate to your WordPress install, you&rsquo;ll be asked to go through the installation process. Let&rsquo;s start with domain1.com. Enter all your database information, but specify a custom table prefix (like &ldquo;domain1_&rdquo;) which will be unique to that domain. Once the installation is complete (make sure you save your password!) you need to delete the wp-config.php file.</p>

<p>Now if you navigate with your other domain, you&rsquo;ll be asked to install WordPress again. This time, use a different table prefix (like &ldquo;domain2_&rdquo;). This will give you two different sets of WordPress tables in your database. The only problem is that you can&rsquo;t access both of them. We&rsquo;ll remedy this next.</p>

<p>Go into your wp-config.php file and find the line that looks something like this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$table_prefix</span>  <span class="o">=</span> <span class="s1">&#39;domain2_&#39;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>We need this variable to be different, depending on what domain is being used to access your blog. Using the PHP $_SERVER super global, we can do this quite easily.</p>

<p>Here&rsquo;s the new code you&rsquo;d want to use.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">if</span> <span class="p">(</span> <span class="s1">&#39;domain1.com&#39;</span> <span class="o">==</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_HOST&#39;</span><span class="p">]</span> <span class="p">)</span>  <span class="p">{</span>
</span><span class='line'><span class="nv">$table_prefix</span> <span class="o">=</span> <span class="s1">&#39;domain1_&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'><span class="nv">$table_prefix</span> <span class="o">=</span> <span class="s1">&#39;domain2_&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So now your server will display two different blogs, depending on what domain is used to access your site. Again, the advantage here is that you only use the space of one set of WordPress files, and you only have to do one update when a new version is released.</p>

<p>Mike talked about some other cool things you can do with this, and talked about how you can address issues with plugins like Google SiteMaps. He promised to post his slides, so if you&rsquo;d like to learn more you should check out <a href="http://www.krotscheck.net/">his blog</a>.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-05-21T22:14:53-07:00" pubdate data-updated="true">May 21<span>st</span>, 2009</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/wordpress/'>WordPress</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2009/05/04/the-obscure-wordpress-get-option-parameter/">
		
			The Obscure WordPress Get_option Parameter</a>
	</h2>
	<div class="entry-content">
		<p>Any WordPress Plugin developer worth their salt knows about the <code>get_option</code> function, which allows options to be retrieved from the database. What I recently discovered is that this function accepts a second parameter, indicating a default value to be returned if the option doesn&rsquo;t exist in the database.</p>

<p>Here&rsquo;s a simple example of the &ldquo;old&rdquo; and &ldquo;new&rdquo; ways of retrieving options from the database:</p>

<p>old:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$option</span> <span class="o">=</span> <span class="nx">get_option</span><span class="p">(</span> <span class="s1">&#39;Option Name&#39;</span> <span class="p">);</span>
</span><span class='line'><span class="k">if</span><span class="p">(</span> <span class="k">false</span> <span class="o">===</span> <span class="nv">$option</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="nv">$option</span> <span class="o">=</span> <span class="s1">&#39;My real option value.&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>new:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$option</span> <span class="o">=</span> <span class="nx">get_option</span><span class="p">(</span><span class="s1">&#39;option_name&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, this simplifies option retrieval and makes your code just a little easier to read.</p>

<p><strong>EDIT:</strong> Thanks <a href="http://nickohrn.com/">Nick Ohrn</a> for pointing out a bug in the first code snippet. I&rsquo;ve updated it so nobody is confused.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-05-04T22:18:54-07:00" pubdate data-updated="true">May 4<span>th</span>, 2009</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/wordpress/'>WordPress</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2009/03/17/limit-your-wordpress-rss-feed-to-one-category/">
		
			Limit Your WordPress RSS Feed to One Category</a>
	</h2>
	<div class="entry-content">
		<p>When designing a recent website, I decided to use Posts for both news items and Portfolio entries. There were several advantages to doing this, but one issue I found was that everything was being thrown together in the RSS feed. I decided to look into filtering the RSS feed to only show posts from the News category. Here&rsquo;s how it works.</p>

<p>As with just about anything in WordPress, you can use Actions and Filters to customize the way WordPress RSS Feeds. I chose to filter the query because it already has built in category filtering functionality. First I hooked into the query filter.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">add_filter</span><span class="p">(</span><span class="s1">&#39;pre_get_posts&#39;</span><span class="p">,</span> <span class="s1">&#39;filterRSSQuery&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then I created a function called &lsquo;filterRSSQuery&rsquo; which does just what the name suggests.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">function</span> <span class="nf">filterRSSQuery</span><span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">is_feed</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;category_name&#39;</span><span class="p">,</span> <span class="s1">&#39;News&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="nv">$query</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The code is pretty straight foreward, but here&rsquo;s a breakdown. First we test to see if the query is for a feed (we don&rsquo;t want to do this filtering anywhere else). Then we set the &lsquo;category_name&rsquo; argument to &lsquo;News&rsquo; (you would change this to whatever category you want to show up). Finally, you return the modified query object.</p>

<p>Overall, this is pretty simple, but extremely powerful.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-03-17T22:23:38-07:00" pubdate data-updated="true">Mar 17<span>th</span>, 2009</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/wordpress/'>WordPress</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2009/02/26/using-jquery-and-gmails-plus-addressing-to-fight-email-spam/">
		
			Using jQuery and Gmail&#8217;s Plus-Addressing to Fight Email Spam</a>
	</h2>
	<div class="entry-content">
		<p>Many people fight spam bots by obfuscating their emails (for example &ldquo;joe [at] example [dot] com&rdquo; or &ldquo;joe@{REMOVETHIS}example.com&rdquo;). This does an OK job, but it&rsquo;s also a royal pain for the visitor, who has to type in, or fix your email address if they want to send you an email. The ultimate spam fighting question arises: &ldquo;How do you keep bots out while letting real users in&rdquo;. GMail&rsquo;s plus-addressing feature and jQuery might be able to bring us one step closer to an answer.</p>

<p>If you use Google&rsquo;s email services (GMail or Google Apps), you have a powerful email feature available. Plus-addressing means that bill&#64;gmail.com, bill+something&#64;gmail.com and bill+anything&#64;gmail.com all point to the same email address. When deciding what address to deliver the message to, Google drops everything after the plus sign. you can then actually use filters to move items to folders inside your mailbox (for example, you could use example+bank&#64;gmail.com for your banking). Doing this also makes it just a little harder (though not impossible) for bots to get your real email address.</p>

<p>By default, you probably don&rsquo;t want to display a &ldquo;plus address&rdquo; on a contact page, jQuery comes to our rescue here, allowing us to remove the &ldquo;plus&rdquo; part for users with JavaScript support. The following script looks for all email links and removes the &ldquo;plus&rdquo; portion from the href and the inner text.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;a[href^=mailto:]&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="nx">removeSpamProtection</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">removeSpamProtection</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">element</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">,</span> <span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\+[a-zA-Z]*/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">link</span><span class="p">.</span><span class="nx">text</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\+[a-zA-Z]*/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now all visitors with JavaScript support will see something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;mailto:example@example.com&quot;</span><span class="nt">&gt;</span>example@example.com<span class="nt">&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Visitors without JavaScript support will see:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;mailto:example+spamblock@example.com&quot;</span><span class="nt">&gt;</span>example+spamblock@example.com<span class="nt">&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Normal visitors will see your real email address while bots and visitors without JavaScript will see something else. The bots will (hopefully) be confused by the plus sign. If not, they will be sending an email to an address that you can easily filter into a &ldquo;maybe spam&rdquo; folder.</p>

<p>So there you have it. A very short piece of JavaScript (thanks to the wonders of jQuery) that you can include in your WordPress theme or install as a separate plugin.</p>

<p>What do you do to protect your email online? Do you have another method that works better? If so, please share it in the comments!</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-02-26T21:26:55-08:00" pubdate data-updated="true">Feb 26<span>th</span>, 2009</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/gmail/'>Gmail</a>, <a class='category' href='/blog/categories/jquery/'>jQuery</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2009/01/14/converting-php-associative-arrays-to-variables/">
		
			Converting PHP Associative Arrays to Variables</a>
	</h2>
	<div class="entry-content">
		<p><strong>EDIT: <a href="http://nickohrn.com/">Nick Ohrn</a> pointed out that <a href="http://us.php.net/extract" title="PHP Manual Entry for extract">extract</a> does this automatically. The following post is still a valid look at how this could be implemented if the functionality didn&rsquo;t already exist, but it is better to use extract because it is likely more efficient.</strong></p>

<p>Associative arrays are one of my favorite PHP features. They&rsquo;re simple to use and easy to understand. Sometimes though, being able to reference the values of associative arrays with variables can be more convenient. Today I&rsquo;m going to share a simple way to convert a associative arrays to variables.</p>

<p>OK, if you&rsquo;re not sure what we&rsquo;re trying to accomplish here, take a look at the following example.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$list</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="s1">&#39;var1&#39;</span> <span class="o">=&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="s1">&#39;value1&#39;</span><span class="p">,</span> <span class="s1">&#39;var2&#39;</span> <span class="o">=&amp;</span><span class="nx">gt</span><span class="p">;</span> <span class="s1">&#39;value2&#39;</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>To reference the elements in the array, you&rsquo;ll have to use the array key like this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">echo</span> <span class="nv">$list</span><span class="p">[</span><span class="s1">&#39;var1&#39;</span><span class="p">];</span> <span class="c1">//prints &#39;value1&#39;</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$list</span><span class="p">[</span><span class="s1">&#39;var2&#39;</span><span class="p">];</span> <span class="c1">//prints &#39;value2&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>What we&rsquo;d like to do instead is reference the values using variable names like this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">echo</span> <span class="nv">$var1</span><span class="p">;</span> <span class="c1">//print &#39;value1&#39;</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$var2</span><span class="p">;</span> <span class="c1">//print &#39;value2&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is possible through what the PHP Manual calls &lsquo;variable variables&rsquo;. The idea is that the value of one variable is used as the name of another variable. Here&rsquo;s an example.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$hello</span> <span class="o">=</span> <span class="s1">&#39;world&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$$hello</span> <span class="o">=</span> <span class="s1">&#39;howdy&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$world</span><span class="p">;</span> <span class="c1">//prints &#39;howdy&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here, the value of <code>$hello</code> is analyzed and used as the name of the variable to which <code>'howdy'</code> is assigned.</p>

<p>Now it&rsquo;s not a big step to expand this to an associative array. Consider the following code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$list</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="s1">&#39;var1&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;value1&#39;</span><span class="p">,</span> <span class="s1">&#39;var2&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;value2&#39;</span> <span class="p">);</span>
</span><span class='line'><span class="k">foreach</span> <span class="p">(</span> <span class="nv">$list</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span> <span class="p">)</span> <span class="p">{</span> <span class="nv">$$key</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$var1</span><span class="p">;</span> <span class="c1">//prints &#39;value1&#39;</span>
</span><span class='line'><span class="k">echo</span> <span class="nv">$var2</span><span class="p">;</span> <span class="c1">//prints &#39;value2&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>So we&rsquo;ve accomplished what we set out to do. I must caution you, though, about a couple of things which might trip you up.</p>

<p>First, make sure the keys are valid variable names. If you don&rsquo;t you&rsquo;ll run into problems when you execute the script.</p>

<p>Second, be <em>very</em> careful when using this with user input. For example, the following code is insecure.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">// login.php</span>
</span><span class='line'><span class="c1">// checks the username and password in the GET request</span>
</span><span class='line'><span class="nv">$realuser</span> <span class="o">=</span> <span class="s1">&#39;me&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$realpass</span> <span class="o">=</span> <span class="s1">&#39;secret&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">foreach</span> <span class="p">(</span> <span class="nv">$_GET</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span> <span class="p">)</span> <span class="p">{</span> <span class="nv">$$key</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span> <span class="nv">$user</span> <span class="o">==</span> <span class="nv">$realuser</span> <span class="o">&amp;&amp;</span> <span class="nv">$pass</span> <span class="o">==</span> <span class="nv">$realpass</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'> <span class="k">echo</span> <span class="s1">&#39;login correct&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'> <span class="k">echo</span> <span class="s1">&#39;login incorrect&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>There are several problems here. First, we don&rsquo;t <em>know</em> that $user and $pass have been initialized. We should check this before using them. Second (and more importantly) a cleverly generated request could let a user log in without a correct username/password. For example: <code>login.php?user=me&amp;pass=wrong&amp;realpass=wrong</code></p>

<p>When the script runs through the list of variables, it will assign a new value of <code>wrong</code> to $realpass. Because <code>$realpass</code> and <code>$pass</code> have the same value (as do <code>$user</code> and <code>$realuser</code>), the page will allow them to log in.</p>

<p>Here is a way to keep things a little safer by prefixing all the <code>$_GET[]</code> values.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1">// login.php</span>
</span><span class='line'><span class="c1">// checks the username and password in GET request</span>
</span><span class='line'><span class="nv">$realuser</span> <span class="o">=</span> <span class="s1">&#39;me&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$realpass</span> <span class="o">=</span> <span class="s1">&#39;secret&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">foreach</span> <span class="p">(</span> <span class="nv">$_GET</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span> <span class="p">)</span> <span class="p">{</span> <span class="err">$</span><span class="p">{</span><span class="s1">&#39;get_&#39;</span><span class="p">;</span> <span class="o">.</span> <span class="nv">$key</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span> <span class="nb">isset</span><span class="p">(</span> <span class="nv">$get_user</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span> <span class="nv">$get_pass</span> <span class="p">)</span>
</span><span class='line'>    <span class="o">&amp;&amp;</span> <span class="nv">$get_user</span> <span class="o">==</span> <span class="nv">$realuser</span> <span class="o">&amp;&amp;</span> <span class="nv">$get_pass</span> <span class="o">==</span> <span class="nv">$realpass</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'> <span class="k">echo</span> <span class="s1">&#39;login correct&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'> <span class="k">echo</span> <span class="s1">&#39;login incorrect&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now the <code>$_GET[]</code> values are prefixed with <code>get_</code> so they can&rsquo;t interfere with other variables in the script. Additionally <code>isset</code> is used to ensure that the values of the variables has actually been set.</p>

<p>To use something like this, you&rsquo;d still need to check for invalid variable names, but I won&rsquo;t go into that for this example.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-01-14T21:39:35-08:00" pubdate data-updated="true">Jan 14<span>th</span>, 2009</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/php/'>PHP</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2009/01/14/wamp-alias-directories/">
		
			Wamp Alias Directories</a>
	</h2>
	<div class="entry-content">
		<p>I use <a href="http://www.wampserver.com/">Wamp Server</a> together with <a href="http://www.jetbrains.com/phpstorm/">PhpStorm</a> to develop PHP applications on my local machine.
This works well because I can do debugging (thanks to <a href="http://www.xdebug.org/">xdebug</a>) and can readily view and edit files.
I usually don&rsquo;t like to place projects in the <code>c:\wamp\www</code> folder, preferring instead to place them in more logical places in my personal directory.
Wamp alias directories are a great way to improve project organization.</p>

<p>The easiest way to facilitate this is to create alias directories in Apache that point to these different locations. Wamp Server provides an interface for creating wamp alias directories for Apache.</p>

<h2>Adding Wamp Alias Directories</h2>

<p>Click on the tray icon and select Apache &rarr; Alias directories &rarr;  Add an alias. A new command prompt window opens where you can enter the alias information.</p>

<p>Creating an alias like this, you&rsquo;ll probably notice that in order for the URL to work, you have to have a trailing slash at the end (e.g. <code>http://localhost/example/</code> will work while <code>http://localhost/example</code> won&rsquo;t). This can be a bit of a pain, but there is fortunately a quick fix.</p>

<h2>Fixing Your Wamp Alias Directories</h2>

<p>Click on the Wamp Server tray icon again and select Apache &rarr; Alias directories &rarr; [alias url] &ndash;> Edit alias. This will open the alias file in Notepad. Remove the trailing slash from the relative URL.</p>

<p>For Example</p>

<p><code>Alias /example/ "c:/path/to/example/"</code></p>

<p>Would become</p>

<p><code>Alias /example "c:/path/to/example/"</code></p>

<p>Save the file and close Notepad. Wamp Server should restart automatically (if not, you can restart it manually from the tray icon). Once it has restarted, you&rsquo;re alias should now work with or without the trailing slash. Why Wamp Server doesn&rsquo;t do this automatically, I&rsquo;m not sure, but at least there&rsquo;s a simple fix.</p>

<h2>Updating Wamp so Alias Directories Just Work</h2>

<p>Thanks to Ozan Hazer for pointing out that you can actually change the alias template, and save yourself from having to perform multiple steps every time you add an alias.</p>

<p>Open <code>c:\wamp\scripts\addAlias.php</code> and locate the line starting with <code>$newConfFileContents =</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Find:
</span><span class='line'>$newConfFileContents = 'Alias /'.$newAliasDir.'/
</span><span class='line'>
</span><span class='line'># Replace it with:
</span><span class='line'>$newConfFileContents = 'Alias /'.$newAliasDir.'</span></code></pre></td></tr></table></div></figure>


<p>Open <code>c:\wamp\scripts\refresh.php</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Find:
</span><span class='line'>preg_match('|^Alias /'.$newalias_dir.'/ "(.+)"|',$alias_contents,$match);
</span><span class='line'>
</span><span class='line'># Replace it with:
</span><span class='line'>preg_match('|^Alias /'.$newalias_dir.'/ "(.+)"|',$alias_contents,$match);</span></code></pre></td></tr></table></div></figure>


<p>Be sure to back up these files before you edit them, since breaking them could potentially break other Wamp functionality.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-01-14T12:45:43-08:00" pubdate data-updated="true">Jan 14<span>th</span>, 2009</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/apache/'>Apache</a>, <a class='category' href='/blog/categories/wamp/'>Wamp</a>


</div>
	
</div>
</article>

<nav id="pagenavi">
    
        <a href="/blog/page/4/" class="prev">Prev</a>
    
    
        <a href="/blog/page/6/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2014

    Will Anderson

</footer>
	<script src="/javascripts/slash.js"></script>





<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6776456-2', 'willi.am');
  ga('send', 'pageview');

</script>
</body>
</html>