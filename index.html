
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Will Anderson</title>
	<meta name="author" content="Will Anderson">

	
	<meta name="description" content="Vim macros are great.
If you&rsquo;re not familiar with them, there&rsquo;s a great Vim tips article. Something cool I&rsquo;ve discovered is that &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Will Anderson" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">Will Anderson</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/plugins">WordPress Plugins</a></li>
	<li><a href="/node-modules">Node Modules</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/plugins">WordPress Plugins</a></li>
	<li><a href="/node-modules">Node Modules</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:willi.am">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/itsananderson" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/itsananderson" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:willi.am">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/06/20/editing-vim-macros/">
		
			Editing Vim Macros</a>
	</h2>
	<div class="entry-content">
		<p>Vim macros are great.
If you&rsquo;re not familiar with them, there&rsquo;s a great <a href="http://vim.wikia.com/wiki/Macros">Vim tips article</a>.</p>

<p>Something cool I&rsquo;ve discovered is that you can edit macros.
This is helpful if you accidentally mess up a macro recording, or decide you need to tweak it in some way.</p>

<p>If you recorded a macro to register <code>a</code>, you can paste its contents into the current document with <code>"ap</code>.
From there, you can edit the macro and then yank it back into the <code>a</code> register with <code>"ay</code></p>

<p>This makes it easy to paste your macros into your vimrc for future use.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="c">&quot; delete first word of line</span>
</span><span class='line'><span class="k">let</span> @<span class="k">d</span><span class="p">=</span><span class="s1">&#39;0dw&#39;</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-06-20T22:37:17-07:00" pubdate data-updated="true">Jun 20<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/vim/'>Vim</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/06/15/resolving-javascript-objects-containing-promises/">
		
			Resolving JavaScript Objects Containing Promises</a>
	</h2>
	<div class="entry-content">
		<p>Dealing with multiple asynchronous calls makes JavaScript promises outshine the classic callback pattern.
Unlike callbacks, you can wait for multiple promises to complete before proceeding.
For example, in the <a href="https://github.com/kriskowal/q">Q</a> framework, you can use the <code>Q.all()</code> function to wait for multiple promises to complete.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">makePromise</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">promises</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>  <span class="nx">makePromise</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">makePromise</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">makePromise</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">makePromise</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
</span><span class='line'><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Q</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">promises</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span> <span class="c1">// [1,2,3,4]</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, this works well for an array, but as promise dependencies increase, it may be useful to reference these values more descriptively than an array index.
Usually, you&rsquo;d want to wrap dependencies in an object like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">dependencies</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="s1">&#39;db&#39;</span><span class="o">:</span> <span class="nx">connectToDb</span><span class="p">(),</span>
</span><span class='line'>  <span class="s1">&#39;api&#39;</span><span class="o">:</span> <span class="nx">getApi</span><span class="p">(),</span>
</span><span class='line'>  <span class="s1">&#39;third&#39;</span><span class="o">:</span> <span class="nx">someOtherDependency</span><span class="p">()</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, Q doesn&rsquo;t have a way to await the promises inside this object.
If you just pass it to <code>Q.all()</code> it will finish before the promises are resolved, because the &ldquo;dependencies&rdquo; variable is an object, not a promise.
However, there is a pretty simple workaround using Lo-Dash (or Underscore):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">Q</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">dependencies</span><span class="p">)).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">zipObject</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">dependencies</span><span class="p">),</span> <span class="nx">results</span><span class="p">);</span>
</span><span class='line'><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">deps</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">deps</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// {</span>
</span><span class='line'>  <span class="c1">//   &quot;db&quot;: [db connection],</span>
</span><span class='line'>  <span class="c1">//   &quot;api&quot; [api object],</span>
</span><span class='line'>  <span class="c1">//   &quot;third&quot;: [third dependency]</span>
</span><span class='line'>  <span class="c1">// }</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Basically we&rsquo;re unzipping the keys and values from the &ldquo;dependencies&rdquo; object, then rezipping them with the <code>_.zipObject()</code> function when the promises are resolved.</p>

<p>Note that you can safely mix promises and non-promises.
For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">dependencies</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="s1">&#39;db&#39;</span><span class="o">:</span> <span class="nx">connectToDb</span><span class="p">(),</span>
</span><span class='line'>  <span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="s1">&#39;Bob&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;version&#39;</span><span class="o">:</span> <span class="mi">3</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Also note that this only works on a &ldquo;flat&rdquo; object.
Any nested objects won&rsquo;t be resolved.
It wouldn&rsquo;t be terribly difficult to write a utility function for recursively traversing an object and awaiting its promises, but I&rsquo;ll leave that as an exercise for the reader.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-06-15T15:12:43-07:00" pubdate data-updated="true">Jun 15<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/javascript/'>JavaScript</a>, <a class='category' href='/blog/categories/promises/'>Promises</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/06/09/learning-clojure/">
		
			Learning Clojure</a>
	</h2>
	<div class="entry-content">
		<p>I&rsquo;ve decided I&rsquo;m too familiar with the languages I use every day.
Well, I say that as if this is a recent realization.
I decided this about a year ago, and decided Clojure was the next language I should learn.</p>

<p>I did some initial research on the language, and found <a href="http://joyofclojure.com/">a Clojure book</a> by an author I&rsquo;d read before.
It had a second edition coming out soon, so I decided to pre-order that.</p>

<p>A year later, the book is finally on the way :)</p>

<p>It&rsquo;s good timing, though.
The last year has been a whirlwind.
I joined a new team at work, worked on 5-6 projects (literally lost count), and bought a house.
You know, the usual.</p>

<p>Things are finally settling down again a little, so what better time to take on another hobby?</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-06-09T01:12:14-07:00" pubdate data-updated="true">Jun 9<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/clojure/'>Clojure</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/06/02/ending-a-stream-without-consuming-its-data/">
		
			Ending a Stream Without Consuming Its Data</a>
	</h2>
	<div class="entry-content">
		<p>I ran into an issue recently while writing <a href="https://www.npmjs.org/package/placebase">a node module</a>.
My process would sometimes complete its work, but wouldn&rsquo;t end.
After a bit of debugging, I figured out what was happening.</p>

<p>I had implemented a handler for the HTTP &ldquo;location&rdquo; header.
If a response came back with that header, I would ignore that response and go fetch the new location instead.
Unfortunately, whenever I did that, the process would finish fetching the new location, and then just hang there for about a minute bofore exiting.
The reason this happened was because I wasn&rsquo;t properly handling the first response.</p>

<p>Here&rsquo;s an oversimplified explanation of what happens.
This is from my limited understanding of Node internals, so the details may be slighly off, but the overall idea is correct.</p>

<p>When you use the &ldquo;http&rdquo; module to make a request in Node, the response it gives you is a stream.
If you don&rsquo;t do anything to consume that stream&rsquo;s data, Node doesn&rsquo;t exit because there&rsquo;s still work to be done (consuming the stream).
In order to get Node to exit without something clunky like process.exit(), you just need to switch the stream to &ldquo;flowing&rdquo; mode.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">responseHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">location</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">location</span><span class="p">,</span> <span class="nx">responseHandler</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">response</span><span class="p">.</span><span class="nx">resume</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">response</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">responseHandler</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice on line 6 how I&rsquo;ve called response.resume().
This switches the response stream to &ldquo;flowing&rdquo; mode.
According to the <a href="http://nodejs.org/api/stream.html#stream_readable_resume">streams documentation</a>,
this is the way to finish a stream if you don&rsquo;t care about consuming its data.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-06-02T10:28:46-07:00" pubdate data-updated="true">Jun 2<span>nd</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/node/'>Node</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/05/22/escaping-exclamation-marks-in-bash/">
		
			Escaping Exclamation Marks in Bash</a>
	</h2>
	<div class="entry-content">
		<p>If you&rsquo;ve ever committed to Git in either frustration or excitement, you&rsquo;ve probably seen a message like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git commit -m <span class="s2">&quot;It works!&quot;</span>
</span><span class='line'>-bash: !<span class="err">&quot;</span>: event not found
</span></code></pre></td></tr></table></div></figure>


<p>When Bash encounters an exclamation mark under certain conditions, it tries to expand the expression to the last matching command in your history.
For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;Hello, World&quot;</span>
</span><span class='line'>Hello, World
</span><span class='line'><span class="nv">$ </span>ls
</span><span class='line'>bin  foo.sh
</span><span class='line'><span class="nv">$ </span>!e
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;Hello, World&quot;</span>
</span><span class='line'>Hello, World
</span><span class='line'><span class="nv">$ </span>!l
</span><span class='line'>ls
</span><span class='line'>bin  foo.sh
</span></code></pre></td></tr></table></div></figure>


<p>Notice that the second command <code>!e</code> was expanded to the previous <code>echo "Hello, World"</code> statement, and <code>!l</code> is expanded to the previous <code>ls</code> statement.
This is cool, but can also be annoying if that&rsquo;s not what you want.
Fortunately there&rsquo;s a workaround.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># If you don&#39;t need variable substitution, use single quotes</span>
</span><span class='line'><span class="nv">$ </span>git commit -m <span class="s1">&#39;It works!&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># If you need variable substitution, keep exclamation outside the quotes</span>
</span><span class='line'><span class="nv">$ </span>git commit -m <span class="s2">&quot;Thanks $name&quot;</span><span class="se">\!</span>
</span><span class='line'><span class="c"># Or escape with single quotes</span>
</span><span class='line'><span class="nv">$ </span>git commit -m <span class="s2">&quot;Thanks $name&quot;</span><span class="s1">&#39;!&#39;</span>
</span><span class='line'><span class="c"># Also works in the middle of the line</span>
</span><span class='line'><span class="nv">$ </span>git commit -m <span class="s2">&quot;Thanks&quot;</span><span class="se">\!</span><span class="s2">&quot; $name&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As far as I can tell, these solutions work in both Linux, and Git Bash in Windows.</p>

<p>You can also work around this by leaving of the <code>-m</code> and editing your commit message in vim like a real developer
<img src="/images/post-images/trollface.png" width="30" height="30" style="vertical-align: middle" /></p>

<p>A couple pages I found helpful when figuring this out:</p>

<ul>
<li><a href="http://superuser.com/questions/133780/in-bash-how-do-i-escape-an-exclamation-mark">http://superuser.com/questions/133780/in-bash-how-do-i-escape-an-exclamation-mark</a></li>
<li><a href="http://www.unixli.com/q/answers-why-does-the-exclamation-mark-sometimes-upset-bash-19252.html">http://www.unixli.com/q/answers-why-does-the-exclamation-mark-sometimes-upset-bash-19252.html</a></li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-05-22T18:25:22-07:00" pubdate data-updated="true">May 22<span>nd</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/bash/'>Bash</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/05/14/live-compiling-aspnet-vnext-with-nodemon/">
		
			Live Compiling ASP.NET vNext With Nodemon</a>
	</h2>
	<div class="entry-content">
		<p>Something cool that Scott Hanselman talked about in his <a href="http://www.hanselman.com/blog/IntroducingASPNETVNext.aspx">blog post on vNext</a>
was the ability to save a C# file in Visual Studio and view the change in the browser without manually rebuilding.</p>

<p>After spending a little time messing around with the <a href="https://github.com/aspnet">newly released code</a>, I wanted similar functionality when editing C# files outside Visual Studio.
I didn&rsquo;t see a documented way to do that, but there&rsquo;s an easy workaround if you have Node installed.</p>

<p>First install the &ldquo;nodemon&rdquo; package.
This package monitors a directory for file chanages and respawns a child process whenever anything changes.</p>

<p><code>npm install -g nodemon</code></p>

<p>Now that nodemon is installed, you can use it to live-rerun your app.</p>

<p><code>nodemon --exec "K.cmd web" -e cs,json</code></p>

<p>This tells Nodemon to watch for changes to <em>.cs and </em>.json files and to restart &ldquo;K.cmd web&rdquo; when changes are detected.
Replace &ldquo;web&rdquo; with &ldquo;run&rdquo; or whatever startup command is configured for your project.</p>

<p>Note that if you&rsquo;re running in Git Bash on Windows (which I currently can&rsquo;t get working) or on a Linux/OSX machine, the &mdash;exec command will probably be either <code>K web</code> or <code>K.sh web</code>.</p>

<p><img src="/images/post-images/nodemon-k.png" alt="Live re-compiling with nodemon" /></p>

<p>This functionality is <a href="https://github.com/aspnet/Home/issues/22#issuecomment-43148021">on the way for ASP.NET vNext</a>, but for now this is a handy workaround.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-05-14T12:47:24-07:00" pubdate data-updated="true">May 14<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/asp-dot-net/'>ASP.NET</a>, <a class='category' href='/blog/categories/node/'>Node</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/05/12/net-vnext-sounds-awesome/">
		
			ASP.NET vNext Sounds Awesome</a>
	</h2>
	<div class="entry-content">
		<p>Microsoft made some anouncements about the <a href="http://blogs.msdn.com/b/dotnet/archive/2014/05/12/the-next-generation-of-net-asp-net-vnext.aspx">next generation of ASP.NET today</a>.</p>

<p>David Fowler published a post about <a href="http://davidfowl.com/asp-net-vnext/">the reasoning behind some of the changes</a>.
Scott Hanselman published a post with more details about <a href="http://www.hanselman.com/blog/IntroducingASPNETVNext.aspx">the features that are coming our way</a>.
There&rsquo;s a ton of stuff to be excited about here, but my favorite part is these two paragraphs from Scott&rsquo;s post (emphasis his).</p>

<blockquote><p>The project system is also changing &ndash; we&rsquo;re integrating packages.config, NuGet specifications (nuspec),
and project files (csprojs) into a unified view of your project dependencies expressed in a project.json file.</p>

<p>NuGet packages and class libraries are treated the same.
You get full intellisense in the project.json file and NuGet packages come down automatically and transparently.
Even better, let&rsquo;s say NuGet package Foo.Bar has a bug but you&rsquo;ve only got the NuGet package.
You can make a folder called Foo.Bar in our local project and put the source via &ldquo;git clone&rdquo; in that folder.
This is great for open source projects.
<strong>That local version overrides the NuGet, allowing you to easily patch bugs locally in libraries while you wait for a new release.</strong>
When a new fixed NuGet-distributed version shows up, update the version and delete the local source.</p>

<p><a href="http://www.hanselman.com/blog/IntroducingASPNETVNext.aspx">Introducing ASP.NET vNext &ndash; Scott Hanselman</a></p></blockquote>

<p>Mind. Blown.</p>

<p><img src="/images/post-images/mind-blown.gif" alt="Mind Blown" /></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-05-12T19:32:26-07:00" pubdate data-updated="true">May 12<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/asp-dot-net/'>ASP.NET</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/05/12/git-concepts-branches-forks-and-pull-requests/">
		
			Git Concepts: Branches, Forks, and Pull Requests</a>
	</h2>
	<div class="entry-content">
		<p>My team recently started migrating our source control from TFVC to Git (yay!).
There&rsquo;s been some confusion about a few Git and DVCS related terms.
If you&rsquo;re also confused, don&rsquo;t worry. You&rsquo;re not the only one.</p>

<iframe class="youtube-player" type="text/html" width="640" height="385" src="https://www.youtube.com/embed/k2vJNNAQZlg" allowfullscreen frameborder="0">
</iframe>


<p>Let&rsquo;s talk about some basic Git concepts.</p>

<h2>Branches</h2>

<p>Branches are a core concept in Git.
Unlike centralized version control, branches in Git don&rsquo;t show up as folders in the file system.
Instead, your project folder only contains the contents of one branch, which you &ldquo;checkout&rdquo; into your working directory.</p>

<p>Internally, branches are basically a pointer to a commit, designed to move forward when new commits are created.</p>

<p>See <a href="http://www.git-scm.com/book/en/Git-Branching-Basic-Branching-and-Merging">this page on git branches</a> for more details.</p>

<h2>Forks</h2>

<p>Forking is a concept that exists outside Git.
In the old days, forking an open source project meant splitting off from the original project, either to continue development or move in a different direction.</p>

<p>These days a fork is simply a feature of several open source code hosting websites.
If I want to introduce a change to an open source project, I obviously can&rsquo;t just edit the repository directly.
Instead, what I have to do is fork the repository, which creates a copy of that repository that belongs to me.
I can then modify that fork and, if desired, propose those changes back to the original repository.</p>

<p>GitHub has a pretty good <a href="https://help.github.com/articles/fork-a-repo">article on forking repositories</a>.
It also talks about creating pull requests.</p>

<h2>Pull Requests</h2>

<p>One of the most easily misunderstood concepts in Git is the pull request.
Part of the reason for the confusion is that in most current pull request workflows, nobody ever &ldquo;pulls&rdquo; changes.
&ldquo;Merge request&rdquo; would be a more accurate term.</p>

<p>When you create a pull request on an open source project, you&rsquo;re usually asking that changes from a branch in your repository be merged with a branch on another repository.
In most cases, your repository is a fork of the other repository, and you&rsquo;re requesting to merge your changes into their master branch.</p>

<p>Pull requests can also be used as a code review workflow within a single repository.
I&rsquo;ve done this for some of my own open source projects.
It&rsquo;s really useful for teams who work together on a project.</p>

<p>If you&rsquo;re not already doing your feature work in a branch, you should learn to <a href="http://willi.am/blog/2014/05/06/git-for-devs-who-cant-commit-good/">commit good</a>.
Once you&rsquo;re doing your work in a branch, pull requests are the next logical step.
As soon as you&rsquo;re at a point where you&rsquo;re not embarassed by your code, create a pull request.
You can continue pushing new changes to your branch for reviewers to see.
By starting the feedback loop as early as possible, your peers can help catch issues that you&rsquo;d otherwise have to spend a long time undoing.</p>

<p>The other thing pull requests for team projects enables is multiple collaborators.
Most other code review tools only belong to one person.
This is a hassle if two people have collaborated on a feature.
With pull requests, many collaborators can push to a single branch, and all changes can be reviewed as a single unit.</p>

<p>Once again, GitHub has a good <a href="https://help.github.com/articles/using-pull-requests">article on pull requests</a>.
This one is very specific to GitHub&rsquo;s pull request workflow.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-05-12T10:57:58-07:00" pubdate data-updated="true">May 12<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/git/'>Git</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/05/08/inspecting-git-traffic-in-fiddler/">
		
			Inspecting Git Traffic in Fiddler</a>
	</h2>
	<div class="entry-content">
		<p>If you ever need to inspect Git traffic to diagnose problems, or are just curious about the internal workings of Git, it&rsquo;s pretty easy to make Git send traffic through Fiddler.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git config --global http.proxy 127.0.0.1:8888
</span><span class='line'>git config --global http.sslVerify false</span></code></pre></td></tr></table></div></figure>


<p>This tells Git to use Fiddler as the proxy, and to turn off SSL certificate verification (so it doesn&rsquo;t balk at Fiddler&rsquo;s cert).</p>

<p>Make sure Fiddler&rsquo;s actually running, or Git won&rsquo;t be able to connect.</p>

<p>If you just want to use Fiddler for a single repository, run the commands from within that repository without the <code>--global</code> flag. Obviously this work for the <code>git clone</code> command, so you&rsquo;ll have to use a global configuration if you want to inspect that.</p>

<p>When you&rsquo;re done, make sure you undo your changes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git config --global --unset http.proxy
</span><span class='line'>git config --global --unset http.sslVerify</span></code></pre></td></tr></table></div></figure>


<p>Again, remove the <code>--global</code> flag if you&rsquo;re just inspecting traffic for a single repository.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-05-08T07:32:26-07:00" pubdate data-updated="true">May 8<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/fiddler/'>Fiddler</a>, <a class='category' href='/blog/categories/git/'>Git</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/05/07/running-express-4-sites-on-azure/">
		
			Running Express 4 Sites on Azure</a>
	</h2>
	<div class="entry-content">
		<p>If you&rsquo;ve created an Express 4 app with the new scaffold utility recently, you may have noticed that it doesn&rsquo;t work in Azure. When you try to load the site, it fails with the following error:</p>

<blockquote><p>The page cannot be displayed because an internal server error has occurred.</p></blockquote>

<h2>The Diagnosis</h2>

<p>This is because of the new structure Express creates for its apps. Instead of app.js being the expected entry point, Express now specifies bin/www as the entry point for starting the server.</p>

<p>I suspect the reason for this is so that the newly scaffolded app can be consumed as a module, allowing the consumer to worry about port binding etc. Unfortunately, this causes problems for Azure.</p>

<p>When Azure starts a Node.js site, it looks for either a server.js or an app.js. As far as I can tell from my admittedly limited testing, it doesn&rsquo;t seem look at package.json for an alternate entry point. Because of this, when it includes app.js, nothing ever binds to the listening port, so the app immediately exits on startup.</p>

<h2>The Workaround</h2>

<p>Since Azure first looks for a server.js file when it starts a site, the easiest solution I&rsquo;ve found is to add a <code>server.js</code> file with the following contents.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./bin/www&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, when Azure starts your site, it will require server.js, which will require bin/www, which will require app.js. After that somewhat convoluted redirection chain, all will again be right in the world.</p>

<p>The Azure documentation has an <a href="http://azure.microsoft.com/en-us/documentation/articles/cloud-services-nodejs-develop-deploy-express-app/">alternative workaround</a> (see steps 4 and 5 of &ldquo;Install Express&rdquo;), but I don&rsquo;t care for it.
The problem with their solution is that it duplicates the code from bin/www into server.js, which means any updates you make to bin/www will also need to be applied to server.js.
Long story short, code duplication sucks.</p>

<h2>The Solution</h2>

<p>There are a couple of things that would properly solve this problem instead of just working around it.</p>

<h3>Express Scaffold Fix</h3>

<p>There are probably a few ways Express could fix this, but the simplest I can think of would be to add a server.js that does the same thing as my workaround.
If that&rsquo;s not desirable for all sites, they could add a &ldquo;Azure compatibility&rdquo; flag that explicitly adds the sever.js workaround.</p>

<h3>Azure Fix</h3>

<p>In my oppinion, Azure should have a way to specify the entry-point in package.json rather than hardcoding to app.js and server.js.</p>

<p>The conventional <code>npm start</code> configuration is a logical place to begin, since it&rsquo;s a <a href="https://www.npmjs.org/doc/misc/npm-scripts.html">supported spec from npm</a>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>    "scripts": {
</span><span class='line'>        "start" : "&lt;path&gt;"
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Azure relies on iisnode, which probably can&rsquo;t consume package.json directly.
However, Azure could look at a setting in package.json during the site setup process (when it does stuff like package restore), and configure web.config, just like it does now to switch between app.js and server.js.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-05-07T06:57:05-07:00" pubdate data-updated="true">May 7<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/azure/'>Azure</a>, <a class='category' href='/blog/categories/express/'>Express</a>, <a class='category' href='/blog/categories/node/'>Node</a>


</div>
	
</div>
</article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2014

    Will Anderson

</footer>
	<script src="/javascripts/slash.js"></script>





<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6776456-2', 'willi.am');
  ga('send', 'pageview');

</script>
</body>
</html>