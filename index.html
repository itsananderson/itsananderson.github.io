
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Will Anderson</title>
	<meta name="author" content="Will Anderson">

	
	<meta name="description" content="At my job, it&rsquo;s not uncommon to work on a change that builds on another change which is still in code review. Sometimes a coworker is adding a &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@itsananderson" />
    <meta name="twitter:title" content="Will Anderson" />
    <meta name="twitter:description" content="At my job, it&rsquo;s not uncommon to work on a change that builds on another change which is still in code review. Sometimes a coworker is adding a &hellip;" />

	<link href="http://william-backend.azurewebsites.net/feed/" rel="alternate" title="Will Anderson" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Will Anderson</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/work-with-me">Work With Me</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/work-with-me">Work With Me</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:willi.am">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/itsananderson" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/itsananderson" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="http://william-backend.azurewebsites.net/feed/" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:willi.am">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2018/03/25/simple-trick-for-juggling-related-git-branches/">
		
			Simple Trick for Juggling Related Git Branches</a>
	</h2>
	<div class="entry-content">
		<p><link href="http://vjs.zencdn.net/6.6.3/video-js.css" rel="stylesheet"></p>

<p>At my job, it&rsquo;s not uncommon to work on a change that builds on another change which is still in code review. Sometimes a coworker is adding a component that I want to consume, and other times I&rsquo;m just breaking my own work into multiple stages to simplify code review.</p>

<p>We squash commit to master rather than merging development branches, so whenever the code I depend on lands in master, I do an interactive rebase. This removes the unsquashed commits and cleans up my development branch. I also do a similar rebase if the code I&rsquo;m building on is updated while it&rsquo;s still in development.</p>

<p>In either case, it can sometimes be tedious to figure out which commits in my branch are mine, and which commits I&rsquo;m building on. This is especially annoying if I&rsquo;m building on my own branch, because then all the commit authors looks the same. To solve this, I&rsquo;ve started leaving a marker for myself in the form of an empy commit to delineate my changes.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git commit --allow-empty -m "============="</span></code></pre></td></tr></table></div></figure>


<p>This way when I rebase, I get a nice little marker in the interactive rebase screen that tells me where to start throwing away commits.</p>

<p><video id="my-video" class="video-js" controls preload="auto" width="800" height="450" poster="https://itsananderson.blob.core.windows.net/post-videos/rebase-with-marker-after-merge.png" data-setup="{}">
  <source src="https://itsananderson.blob.core.windows.net/post-videos/rebase-with-marker-after-merge.mp4" type='video/mp4'>
  <source src="https://itsananderson.blob.core.windows.net/post-videos/rebase-with-marker-after-merge.webm" type='video/webm'>
</video></p>

<p>Because the commit is empty, the rebase command will automatically ignore it by commenting out the commit. If I&rsquo;m done with the marker, I&rsquo;ll remove it or just leave it commented out. Otherwise, I uncomment that line to keep the marker commit around after the rebase. Either way, since we squash commit to master, the empty commit eventually disappears and doesn&rsquo;t clutter up my Git history.</p>

<p>This is also fairly trivial to even if you have an in-progress branch that you later decide to rebase onto another in-progress branch. Here&rsquo;s how I do it:</p>

<p><video id="my-video" class="video-js" controls preload="auto" width="800" height="450" poster="https://itsananderson.blob.core.windows.net/post-videos/rebase-existing-branch-with-marker.png" data-setup="{}">
  <source src="https://itsananderson.blob.core.windows.net/post-videos/rebase-existing-branch-with-marker.mp4" type='video/mp4'>
  <source src="https://itsananderson.blob.core.windows.net/post-videos/rebase-existing-branch-with-marker.webm" type='video/webm'>
</video></p>

<p>That&rsquo;s pretty much it. I&rsquo;ve found this to be a helpful way to leave myself breadcrumbs, especially when I haven&rsquo;t touched a branch for some time.</p>

<script src="http://vjs.zencdn.net/6.6.3/video.js"></script>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2018-03-25T13:47:12-07:00" pubdate data-updated="true">Mar 25<span>th</span>, 2018</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/git/'>Git</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2017/10/05/adding-timestamps-to-arbitrary-logs/">
		
			Adding Timestamps to Arbitrary Logs</a>
	</h2>
	<div class="entry-content">
		<p>I was recently looking at a log file generated by a cron job and was frustrated to discover that the log didn&rsquo;t have timestamps.
After a little thought, I figured out how to make sure all future logs from that cron job have timestamps.</p>

<p>In my case, the cron job was a Let&rsquo;s Encrypt renewal:</p>

<p><code>/opt/letsencrypt/letsencrypt-auto renew &gt;&gt; /var/log/le-renew.log</code></p>

<p>Since I&rsquo;m not in control of the output of <code>letsencrypt-auto renew</code>, I need to insert the timestamps. Using a Bash <code>while</code> loop solves this easily:</p>

<p><code>/opt/letsencrypt/letsencrypt-auto renew | while read -r l; do echo "$(date) $l"; done &gt;&gt; /var/log/le-renew.log</code></p>

<p>The <code>while -r l</code> reads the output line-by-line into the variable <code>$l</code>, then prints it out, prefixing with the <code>date</code> command.
Then it pipes everything into the same log.</p>

<p>You&rsquo;ll get output like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Tue Oct  3 19:01:03 EDT 2017 
</span><span class='line'>Tue Oct  3 19:01:03 EDT 2017 -------------------------------------------------------------------------------
</span><span class='line'>Tue Oct  3 19:01:03 EDT 2017 Processing /etc/letsencrypt/renewal/mimic.io.conf
</span><span class='line'>Tue Oct  3 19:01:03 EDT 2017 -------------------------------------------------------------------------------
</span><span class='line'>Tue Oct  3 19:01:03 EDT 2017 
</span><span class='line'>Tue Oct  3 19:01:03 EDT 2017 -------------------------------------------------------------------------------
</span><span class='line'>Tue Oct  3 19:01:03 EDT 2017 
</span><span class='line'>Tue Oct  3 19:01:03 EDT 2017 The following certs are not due for renewal yet:
</span><span class='line'>Tue Oct  3 19:01:03 EDT 2017 /etc/letsencrypt/live/mimic.io/fullchain.pem (skipped)
</span><span class='line'>Tue Oct  3 19:01:03 EDT 2017 No renewals were attempted.
</span><span class='line'>Tue Oct  3 19:01:03 EDT 2017 -------------------------------------------------------------------------------
</span><span class='line'>Wed Oct  4 19:01:01 EDT 2017 Upgrading certbot-auto 0.18.2 to 0.19.0...
</span><span class='line'>Wed Oct  4 19:01:01 EDT 2017 Replacing certbot-auto...</span></code></pre></td></tr></table></div></figure>


<p>If you wanted to customize the date format, you could do it like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$(date "+%Y-%m-%d %H:%M:%S")</span></code></pre></td></tr></table></div></figure>


<p>In the cron definition it would look like this:</p>

<p><code>/opt/letsencrypt/letsencrypt-auto renew | while read -r l; do echo "$(date "+%Y-%m-%d %H:%M:%S") $l"; done &gt;&gt; /var/log/le-renew.log</code></p>

<p>If your cron command gets complicated enough, it might be worth moving it to a shell script that you invoke from the cron job.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/bash
</span><span class='line'>
</span><span class='line'>/opt/letsencrypt/letsencrypt-auto renew | while read -r line; do
</span><span class='line'>  echo "$(date "+%Y-%m-%d %H:%M:%S") $line"
</span><span class='line'>done &gt;&gt; /var/log/le-renew.log</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s basically it&hellip;</p>

<p>You could easily prefix your logs with other things as well, but I&rsquo;ll leave that as an exercise for the reader.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2017-10-05T14:07:03-07:00" pubdate data-updated="true">Oct 5<span>th</span>, 2017</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/logs/'>Logs</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2017/09/27/consuming-and-searching-csv-logs-with-json-tools/">
		
			Consuming and Searching CSV Logs With JSON Tools</a>
	</h2>
	<div class="entry-content">
		<p>If you ever find yourself working with logs or traces stored as CSV files,
it&rsquo;s fairly trivial to convert them to JSON to simplify searching and manipulating them.
This blog post describes some tools that can help you filter and format the logs into something more useful.</p>

<p>The two tools we&rsquo;ll be using are <code>csv2json</code> and <code>json</code>.
These are Node modules, so you&rsquo;ll need to install Node first,
then run the following command to install the two packages globally.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>npm install -g csv2json json</span></code></pre></td></tr></table></div></figure>


<p>These tools should now be on your path.
To confirm, try running <code>csv2json --help</code></p>

<p>You can use the <code>csv2json</code> to convert the CSV log files into JSON files.
The JSON format places the column headers next to the column values,
which is less space efficient, but makes it much easier to read the file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>csv2json trace.csv trace.json</span></code></pre></td></tr></table></div></figure>


<p>The JSON traces will then look something like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[
</span><span class='line'>{"PreciseTimeStamp":"3/24/2017 12:25:17 PM","ComponentGuid":"bd3facb0-1775-590d-e3ab-59f56bb23206","EventName":"DownloadStarted","AppId":"cd56de80-67c6-414a-a0af-f6b22a47b6d7"},
</span><span class='line'>{"PreciseTimeStamp":"3/24/2017 12:35:17 PM","ComponentGuid":"bd3facb0-1775-590d-e3ab-59f56bb23206","EventName":"DownloadCompleted","AppId":"cd56de80-67c6-414a-a0af-f6b22a47b6d7"}
</span><span class='line'>...
</span><span class='line'>...
</span><span class='line'>...
</span><span class='line'>]</span></code></pre></td></tr></table></div></figure>


<p>Now at least the column names/values are closer together, so it&rsquo;s easier to see what column type you&rsquo;re dealing with.
However, it&rsquo;s still not easy to visually parse the data.
That&rsquo;s where the <code>json</code> tool comes in.
In its most basic form, it pretty-prints json, making it easier to visually parse:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat trace.json | json
</span><span class='line'>[
</span><span class='line'>  {
</span><span class='line'>    "PreciseTimeStamp": "3/24/2017 12:25:17 PM",
</span><span class='line'>    "ComponentGuid": "bd3facb0-1775-590d-e3ab-59f56bb23206",
</span><span class='line'>    "EventName": "DownloadStarted",
</span><span class='line'>    "AppId": "cd56de80-67c6-414a-a0af-f6b22a47b6d7"
</span><span class='line'>  },
</span><span class='line'>  {
</span><span class='line'>    "PreciseTimeStamp": "3/24/2017 12:35:17 PM",
</span><span class='line'>    "ComponentGuid": "bd3facb0-175-590d-e3ab-59f56bb23206",
</span><span class='line'>    "EventName": "DownloadCompleted",
</span><span class='line'>    "AppId": "cd56de80-67c6-414a-a0af-f6b22a47b6d7"
</span><span class='line'>  }
</span><span class='line'>]</span></code></pre></td></tr></table></div></figure>


<p>Now you can more easily scan down the columns, but it takes up a ton of space, and you probably don&rsquo;t care about most of the columns.
If you only want a few columns, you can use the <code>json -a &lt;ColumnName1&gt; &lt;ColumnName2&gt;</code> command to output specific columns in plaintext.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>type trace.json | json -a PreciseTimeStamp EventName
</span><span class='line'>3/24/2017 12:25:17 PM DownloadStarted
</span><span class='line'>3/24/2017 12:35:17 PM DownloadCompleted</span></code></pre></td></tr></table></div></figure>


<p>If you don&rsquo;t want the intermediate JSON file, you can also pipe the output of <code>csv2json</code> directly to the <code>json</code> command.
However, if you plan to run multiple calls to <code>json</code>, you will save execution time by only calling <code>csv2json</code> once.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>csv2json trace.csv | json -a PreciseTimeStamp EventName</span></code></pre></td></tr></table></div></figure>


<p>Also, if you already have a json file, you can provide its path to the <code>json</code> tool directly rather than using the <code>cat</code> command.
This is really just a matter of preference:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>json -f trace.json -a PreciseTimeStamp EventName
</span><span class='line'>
</span><span class='line'># same as
</span><span class='line'>
</span><span class='line'>cat trace.json | json -a PreciseTimeStamp EventName</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>If you want to filter the logs, you can use the <code>-c</code> flag.
The syntax is JavaScript, and the <code>this</code> variable contains the JSON object for the specific row being filtered.</p>

<p>For example, to filter to a specific <code>EventName</code>, you could use something like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat trace.json | json -a PreciseTimeStamp EventName -c 'this.EventName == "DownloadCompleted"'
</span><span class='line'>3/24/2017 12:35:17 PM DownloadCompleted</span></code></pre></td></tr></table></div></figure>


<p>There&rsquo;s lots more that the <code>json</code> tool can do. Check out the <a href="full%20docs%20here">http://trentm.com/json/</a>.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2017-09-27T21:47:27-07:00" pubdate data-updated="true">Sep 27<span>th</span>, 2017</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/json/'>JSON</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/10/04/writing-useful-tests-naming-tests-and-writing-assertions/">
		
			Writing Useful Tests: Naming Tests and Writing Assertions</a>
	</h2>
	<div class="entry-content">
		<p>Last time I blogged about <a href="/blog/2016/08/22/writing-useful-tests-organization/">organizing your tests</a> so that they&rsquo;re easier to maintain.
Today I want to look at why you should put thought into naming your tests and writing assertions.</p>

<hr />

<p>When you first write your tests, you (hopefully) have all the context of the code you&rsquo;re testing.
You know how the code should work, and you know what your test is trying to validate.
However, if the test starts failing 6 months down the road, you probably won&rsquo;t have all that context.
Writing verbose test names and assertion messages will make it much easier for you to regain that context.</p>

<h2>Naming Things</h2>

<p>It&rsquo;s Monday, and you just poured your first cup of &ldquo;Damn Fine Coffee&rdquo;.</p>

<p><img src="https://itsananderson.blob.core.windows.net/post-images/damngoodcoffee.gif" alt="" /></p>

<p>You&rsquo;re checking the morning influx of email and open an email about failing tests.
You&rsquo;re greeted with this helpful summary:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Failing Tests:
</span><span class='line'>  - User Creation
</span><span class='line'>
</span><span class='line'>  Expected "false" to be "true"</span></code></pre></td></tr></table></div></figure>


<p>Well, that&rsquo;s helpful&hellip;</p>

<p><img src="https://itsananderson.blob.core.windows.net/post-images/more-coffee.gif" alt="" /></p>

<p>Obviously this is a contrived example, but it illustrates two potential problems with your tests.</p>

<h2>Problem 1: Generic Names</h2>

<p>In the example above, the test is called &ldquo;User Creation&rdquo;, which isn&rsquo;t very descriptive.
Now you have to find the code for the test and re-grok it, just to remember what the test does.
Only then can you figure out why it&rsquo;s failing.</p>

<p><img src="https://itsananderson.blob.core.windows.net/post-images/donna-crying.gif" alt="" /></p>

<p>It might be better to call this test something like &ldquo;User creation succeeds with valid email and matching passwords&rdquo; or &ldquo;User creation fails with an invalid email&rdquo;.
If the test does more than what those detailed titles describe, it&rsquo;s probably time to break it into smaller tests.</p>

<h2>Problem 2: Generic Assertions</h2>

<p>The other thing you&rsquo;ll notice from the example is the reason the test failed: <code>Expected "false" to be "true"</code>.</p>

<p>That doesn&rsquo;t really help you track down the problem.
You know there&rsquo;s probably a failing assertion, but if you have many &ldquo;assert&rdquo; statements in your test, it may not be immediately clear whith one failed.
Adding a clear assertion message can make it much simpler to track down the part of the test that&rsquo;s failing.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// Before</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">succeeded</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'><span class="nx">assert</span><span class="p">(</span><span class="nx">succeeded</span><span class="p">);</span>
</span><span class='line'><span class="c1">// Expected &quot;false&quot; to be &quot;true&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// After</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">succeeded</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'><span class="nx">assert</span><span class="p">(</span><span class="nx">succeeded</span><span class="p">,</span> <span class="s2">&quot;User creation should have succeeded&quot;</span><span class="p">);</span>
</span><span class='line'><span class="c1">// Expected &quot;false&quot; to be &quot;true&quot;. User creation should have succeeded</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now it&rsquo;s easy to find the assertion in your code that&rsquo;s failing.
Plus, your &ldquo;tests are failing&rdquo; email will tell you why the test is failing before you&rsquo;ve even fired up your editor.</p>

<h2>That Was Easy</h2>

<p>Ok. You&rsquo;ve fixed your tests. Time to treat yourself to more coffee, and maybe some donuts.</p>

<p><img src="https://itsananderson.blob.core.windows.net/post-images/donuts.gif" alt="" /></p>

<p><em>Yes, I <strong>did</strong> just finish watching <a href="https://en.wikipedia.org/wiki/Twin_Peaks">Twin Peaks</a>. Why do you ask?</em></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-10-04T04:52:58-07:00" pubdate data-updated="true">Oct 4<span>th</span>, 2016</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/testing/'>Testing</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/08/22/writing-useful-tests-organization/">
		
			Writing Useful Tests: Organization</a>
	</h2>
	<div class="entry-content">
		<p>Most people agree that writing tests is an important part of software development.
However, not all tests are created equal.</p>

<p>Working on a number of projects over the years, I&rsquo;ve run into a few pitfalls and gotchas that I want to cover in the next few blog posts.
This won&rsquo;t be a comprehensive guide to testing.
Others have already done a better job of that than I ever could.
I just want to write down the pain points I&rsquo;ve run into, and the techniques that have worked for me.</p>

<h2>Organizing Your Tests</h2>

<p>Figuring out how to organize your tests can be a daunting task, especially when you&rsquo;re starting a new project.
Do you keep your tests beside your feature code, or do you have two distinct &ldquo;src&rdquo; and &ldquo;test&rdquo; directories?
Do you break up your test files by feature? By class? By unit?</p>

<p>I don&rsquo;t think there&rsquo;s one right answer to these questions, but I know what has and hasn&rsquo;t worked for me on my projects.</p>

<h3>Test Location</h3>

<p>I&rsquo;m a fan of keeping your tests close to your source code.
That doesn&rsquo;t necessarily mean every <code>foo.js</code> has a <code>foo.test.js</code> beside it, but I do prefer having source code and test code in the same project, rather than keeping them in distinct source folders.</p>

<p>This collocation of tests and source code encourages the mindset of writing tests and source code being one and the same.
I&rsquo;ve worked on projects where the tests and source were in very different parts of the source repository, and the typical workflow was to write your code, and then figure out how to test it.
Keeping your tests and source code in the same project doesn&rsquo;t necessarily solve this problem completely, but at least it helps keep your tests readily available as you&rsquo;re writing your feature or bug fix.</p>

<h3>Breaking Up Your Tests</h3>

<p>Breaking up your tests into distinct files (and folders if your project is large enough) is a good way to keep them manageable.
I&rsquo;ve worked on projects that had thousands of lines of code in the same test file, and it was a nightmare to find and update tests within those enormous files.
By contrast, projects that have been broken into smaller focused test files made it much easier to find where a test should be added or updated.</p>

<p>How you break up your tests will partly depend on your programming language and the type of project.
I&rsquo;ve found that a good place to look for test grouping is the setup code for your tests.
If you have the same few lines of setup code in several of your tests, consider putting them in the same test file with a shared <code>beforeEach</code> block.
What this looks like will depend on your language and test framework.</p>

<p>By contrast, if you find that your <code>beforeEach</code> block is doing a lot of setup that&rsquo;s not used by most of the tests, consider breaking the file apart into the pieces that use the different components of the setup block.</p>

<p>When you open a test file, it should be clear from the file name what feature(s) are being tested. This will help you navigate your test codebase when it&rsquo;s time to update or add tests.</p>

<h3>Arrange, Act, Assert</h3>

<p>When talking about test structure, it&rsquo;s common to discuss the three parts of a test: Arrange, Act, and Assert.</p>

<ul>
<li>Arrange &ndash; Set up the variables, objects, and mocks you&rsquo;ll use in your test</li>
<li>Act &ndash; Perform the action that you&rsquo;re attempting to test</li>
<li>Assert &ndash; Verify that the action had the expected result</li>
</ul>


<p>This organization structure for tests is probably a cliché, but it&rsquo;s a useful way to think about how you organize your individual tests.
Writing tests that have clear distinctions between these three sections will make it easier for other maintainers to understand what you&rsquo;re trying to test.</p>

<p>I&rsquo;ve sometimes had tests where these distinctions were hard to make, or where I felt like I needed to intermingle assertions in the other parts of the tests.
This usually meant that I was testing too much, and needed to break into multiple tests.</p>

<h2>Conclusion</h2>

<p>Organizing your tests makes them easier to understand, navigate, and update, which makes it much easier and more enjoyable for you and your team to maintain them.
Putting effort and thought into your test structure now will pay dividends in the future.</p>

<p>Next time I&rsquo;ll talk about naming your tests and writing useful test assertion messages.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-08-22T20:31:32-07:00" pubdate data-updated="true">Aug 22<span>nd</span>, 2016</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/testing/'>Testing</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/08/13/the-observer-effect-and-debugging-how-dev-tools-can-change-your-codes-behavior/">
		
			The Observer Effect and Debugging: How Dev Tools Can Change Your Code&#8217;s Behavior</a>
	</h2>
	<div class="entry-content">
		<p>Chrome recently added a new feature to their JavaScript debugger where when you select a piece of code and hover over it, the code is evaluated and displayed in a little popover.
In general, this is very useful.
You can check the value of a variable, or even look at the results of more complex expressions.</p>

<p><img src="https://itsananderson.blob.core.windows.net/post-images/chrome-inspect-selection.gif" alt="Selecting Code and Hovering Shows The Result In Chrome DevTools" /></p>

<p>This is super useful, but it can also cause problems if you&rsquo;re not careful about how you use it.</p>

<p>First, a little physics.
The <a href="https://en.wikipedia.org/wiki/Observer_effect_(physics)">observer effect</a> refers to &ldquo;changes that the act of observation will make on a phenomenon being observed&rdquo;.
That definition precisely describes the behavior of this Chrome DevTools feature.</p>

<p>Consider the following example where I highlight a call to a function that has a side effect (incrementing the variable <code>i</code>).
Whenever I hover over the code, it re-runs that expression, and the value of <code>i</code> increases.</p>

<p><img src="https://itsananderson.blob.core.windows.net/post-images/debug-inspect-selection.gif" alt="Selecting a function call evaluates the function" /></p>

<p>This side effect is fairly benign and easy to detect, but imagine a more complex function with multiple dependencies and obscured side-effects.
Worse, you could observe the value of a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy object</a> without even knowing it might have side effects.</p>

<p><img src="https://itsananderson.blob.core.windows.net/post-images/chrome-proxy-hover.gif" alt="Hovering over Proxy properties evaluates their handler" /></p>

<p>Obviously this also serves as a warning against side effects in proxy handlers, but the point here is that these previews can affect the behavior of your code in significant ways.</p>

<p>Several years ago, I wrote about <a href="/blog/2014/04/08/a-lesson-in-debugging-verify-your-tools/">verifying your tools</a> after a Fiddler visualizer made a debugging session take much longer than it should have taken.
The same principal holds true here.
Like many other professions, understanding how your tools behave is an important part of software development.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-08-13T08:39:00-07:00" pubdate data-updated="true">Aug 13<span>th</span>, 2016</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/debugging/'>Debugging</a>, <a class='category' href='/blog/categories/devtools/'>DevTools</a>, <a class='category' href='/blog/categories/javascript/'>JavaScript</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/08/11/docker-for-windows-dealing-with-windows-line-endings/">
		
			Docker for Windows: Dealing With Windows Line Endings</a>
	</h2>
	<div class="entry-content">
		<p>One of the issues with Docker (or any Linux/macOS based system) on Windows is the difference in how line endings are handled.
Windows ends lines in a carriage return and a linefeed <code>\r\n</code> while Linux and macOS only use a linefeed <code>\n</code>.
This becomes a problem when you try to create a file in Windows and run it on a Linux/macOS system, because those systems treat the <code>\r</code> as a piece of text rather than a newline.</p>

<p>As a concrete example, if you try to clone the <a href="https://github.com/docker-library/wordpress">official WordPress docker image</a> and build the image on Windows, you&rsquo;ll run into problems when it tries to execute the <code>docker-entrypoint.sh</code> file.</p>

<p>The first line of that file is <code>#!/bin/bash</code>, which is the <a href="https://en.wikipedia.org/wiki/Shebang_(Unix)">shebang</a> syntax to say &ldquo;run this file using /bin/bash&rdquo;</p>

<p>However, if the file originated in windows, that first line will be interpreted as &ldquo;run this file using /bin/bash\r&rdquo;, and &ldquo;bash\r&rdquo; of course doesn&rsquo;t exist, so you get this error:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker run wordpress
</span><span class='line'>standard_init_linux.go:175: exec user process caused "no such file or directory"</span></code></pre></td></tr></table></div></figure>


<p>There are a couple of ways to handle this issue.</p>

<h3>Converting Line Endings During Build</h3>

<p>Unix has a handy CLI tool for converting line endings called <code>dos2unix</code>.
If you want to create a robust image, you can install do2unix as a dependency, then convert any files that you copy into the image.
Then as a cleanup step, you can uninstall do2unix from the image (unless the image depends on it after the build).</p>

<p>Your Dockerfile might look something like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>FROM ubuntu:latest
</span><span class='line'>
</span><span class='line'>RUN apt-get update && apt-get install -y dos2unix
</span><span class='line'>
</span><span class='line'>COPY docker-entrypoint.sh /entrypoint.sh
</span><span class='line'>
</span><span class='line'>RUN dos2unix /entrypoint.sh && apt-get --purge remove -y dos2unix && rm -rf /var/lib/apt/lists/*
</span><span class='line'>
</span><span class='line'>ENTRYPOINT ["/entrypoint.sh"]</span></code></pre></td></tr></table></div></figure>


<p>The main idea is to copy the script onto the machine, then use dos2unix to convert the line endings, and finally remove dos2unix from the machine (and clean up the files created by apt-get).</p>

<p>This is a good option if you&rsquo;re managing the image, but what if you&rsquo;re trying to build an image that someone else maintains?</p>

<h3>Cloning Git Projects With Unix Line Endings</h3>

<p>If you just want to clone and build an existing Docker image, you can use a Git flag to store the repository locally with Unix style line endings.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git@github.com:docker-library/wordpress.git --config core.autocrlf=input</span></code></pre></td></tr></table></div></figure>


<p>However, it&rsquo;s worth noting that any new files you create will likely have Windows line endings, so you&rsquo;ll still need to convert them before using them inside the Docker image.</p>

<h3>Conclusion</h3>

<p>That should cover the basics of line endings between Windows and Linux/macOS.
These techniques apply beyond just Docker, but hopefully the Docker-specific details will help someone who&rsquo;s struggling with Docker for Windows.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-08-11T23:54:08-07:00" pubdate data-updated="true">Aug 11<span>th</span>, 2016</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/docker/'>Docker</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/08/08/docker-for-windows-interactive-sessions-in-mintty-git-bash/">
		
			Docker for Windows: Interactive Sessions in MinTTY Git Bash</a>
	</h2>
	<div class="entry-content">
		<p>I recently installed Docker for Windows on my laptop. When I tried running the default <code>docker run -it ubuntu bash</code> demo from Git Bash, I ran into an issue I hadn&rsquo;t seen before.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker run -it ubuntu bash
</span><span class='line'>the input device is not a TTY. If you are using mintty, try prefixing the command with 'winpty'</span></code></pre></td></tr></table></div></figure>


<p>As it turns out, following the instructions and prefixing the command with <code>winpty</code> does work</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ winpty docker run -it ubuntu bash
</span><span class='line'>root@88448b75631d:/#</span></code></pre></td></tr></table></div></figure>


<p>However, I&rsquo;m never satisfied with just getting around an issue, so I did some more digging.
Turns out the issue here is the use of MinTTY to host the Git Bash prompt.
If you&rsquo;ve installed Git for Windows, you&rsquo;ll recall the following configuration window.</p>

<p><img src="https://itsananderson.blob.core.windows.net/post-images/git-bash-mintty.png" alt="Git Bash MinTTY configuration" /></p>

<p>If you select the &ldquo;Use MinTTY&rdquo; option, your Bash pompt will be hosted in the MinTTY terminal emulator, rather than the CMD console that ships with Windows.
The MinTTY terminal emulator isn&rsquo;t compatible with Windows console programs unless you prefix your commands with <code>winpty</code>.</p>

<p>Personally, I prefer the default CMD console, especially in Windows 10 where features like window resizing and text selection are drastically improved.
If you want to go back to that mode, simply re-run the Git for Windows installer and chose the non-MinTTY option.
If you want to stick with MinTTY, you just need to prefix your interactive Docker (and Python, and Node, and &hellip;) commands with <code>winpty</code>.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-08-08T19:01:41-07:00" pubdate data-updated="true">Aug 8<span>th</span>, 2016</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/docker/'>Docker</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2016/07/30/docker-for-windows-sharing-host-volumes/">
		
			Docker for Windows: Sharing Host Volumes</a>
	</h2>
	<div class="entry-content">
		<p>I&rsquo;ve been playing with the new &ldquo;Docker for Windows&rdquo; tool recently, and I wanted to share a slightly obscure issue I ran across.</p>

<p>Docker lets you share volumes between your containers and your host machine. This is handy during development time, when you want to be able to quickly iterate without having to continually rebuild your container.</p>

<h3>The Suspicious Empty Directory</h3>

<p>When I first tried sharing a volume, I typed this into PowerShell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&gt; dir c:\docker
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    Directory: C:\docker
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Mode                LastWriteTime         Length Name
</span><span class='line'>----                -------------         ------ ----
</span><span class='line'>-a----        7/30/2016   9:47 PM              8 test.txt
</span><span class='line'>
</span><span class='line'>&gt; docker run -it -v c:/docker:/host ubuntu bash
</span><span class='line'>root@333a10babe3a:/# ls /host
</span><span class='line'>root@333a10babe3a:/#</span></code></pre></td></tr></table></div></figure>


<p>Hmm&hellip; As you can see, the <code>c:\docker</code> folder has a test file, but it doesn&rsquo;t show up in the Docker container.
After some head scratching, I figured out the missing piece: Out of the box, Docker isn&rsquo;t configured with permissions to share your drives with your containers.</p>

<h3>Giving Docker Access</h3>

<p>To give Docker access to your computer&rsquo;s drives, right click on the Docker icon in your taskbar, then click &ldquo;Settings&hellip;&rdquo;</p>

<p><img src="https://itsananderson.blob.core.windows.net/post-images/docker-settings.gif" alt="" /></p>

<p>Under the &ldquo;Shared Drives&rdquo; section, check the drives you&rsquo;d like to share, then click &ldquo;Apply&rdquo;</p>

<p><img src="https://itsananderson.blob.core.windows.net/post-images/docker-shared-drives.png" alt="" /></p>

<p>Docker will ask you for credentials, which it uses to access the drives.</p>

<p><img src="https://itsananderson.blob.core.windows.net/post-images/docker-shared-drives-credentials.png" alt="" /></p>

<p>(Note that if you log into your computer with a Windows Live account, your username should be something like &ldquo;MicrosoftAccount\you&#64;live.com&rdquo;)</p>

<p>Once you save your credentials, you should be able to share volumes from your host computer to your containers.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&gt;docker run -it -v c:/docker:/host ubuntu bash
</span><span class='line'>root@00aca8c2f880:/# ls /host
</span><span class='line'>test.txt
</span><span class='line'>root@00aca8c2f880:/#</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2016-07-30T21:15:38-07:00" pubdate data-updated="true">Jul 30<span>th</span>, 2016</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/docker/'>Docker</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2015/09/05/software-engineering-and-the-no-true-scotsman-fallacy/">
		
			Software Engineering and the No True Scotsman Fallacy</a>
	</h2>
	<div class="entry-content">
		<blockquote><p>&ldquo;If you rely on jQuery you&rsquo;re a jQuery developer, not a <em>real</em> developer.&rdquo;</p>

<p>&ldquo;Nobody actually <em>enjoys</em> writing JavaScript, they just do it because it&rsquo;s the only thing that runs in the browser&rdquo;</p>

<p>&ldquo;Only academics use languages like Haskell and Lisp&rdquo;</p>

<p>&ldquo;Real developers don&rsquo;t use Windows&rdquo;</p></blockquote>

<p>If you&rsquo;ve been in the developer community for any time at all, you&rsquo;ve probably heard statements like these. They&rsquo;re popular because they&rsquo;re easy to repeat and they boost the ego of the person who says them. They&rsquo;re also over-generalizations.</p>

<p>Sure, some developers rely too heavily on jQuery. JavaScript definitely has some not-good parts that annoy many developers. Some technologies are mostly used in academia. Lots of developers prefer OS X and Linux.</p>

<p>But that&rsquo;s not the whole picture.</p>

<p>Many developers know when to use jQuery for a quick solution, and when to reach for other tools. Lots of developers actually like JavaScript, and use it everywhere they can. There are large communities of people building real software with &ldquo;academic&rdquo; technology. While you and I are tweaking our <code>.bash_profile</code>, lots of <em>real</em> developers are using Windows and Visual Studio to get shit done.</p>

<p>I believe these kinds of generalizations continue to live on partly because of the &ldquo;No true Scotsman&rdquo; fallacy.</p>

<blockquote><p><em>Person A</em>: &ldquo;No Scotsman puts sugar on his porridge.&rdquo;</p>

<p><em>Person B</em>: &ldquo;But my uncle Angus likes sugar with his porridge.&rdquo;</p>

<p><em>Person A</em>: &ldquo;Ah yes, but no <em>true</em> Scotsman puts sugar on his porridge.&rdquo;</p>

<p><strong><a href="https://en.wikipedia.org/wiki/No_true_Scotsman#Examples">No true Scotsman</a> &ndash; Wikipedia</strong></p></blockquote>

<p>The core of this fallacy is the rejection of evidence that contradicts our beliefs. It&rsquo;s sort of a rhetorical form of <a href="https://en.wikipedia.org/wiki/Confirmation_bias">confirmation bias</a>.</p>

<p>What a convenient thing to be able to say &ldquo;No real developer does X&rdquo;. Any counter-examples can be easily rejected, because obviously anyone who says &ldquo;wait, I do X&rdquo; isn&rsquo;t a real developer. No need to actually back up your claim.</p>

<p>Instead of rejecting technology, patterns, or methodologies because they&rsquo;re not what &ldquo;real developers&rdquo; use, we should be willing to listen to people who have chosen that path. They chose it for a reason, and it&rsquo;s worth hearing them out, even if their situation doesn&rsquo;t match your own.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2015-09-05T08:00:51-07:00" pubdate data-updated="true">Sep 5<span>th</span>, 2015</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/programming/'>Programming</a>


</div>
	
</div>
</article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2020

    Will Anderson

</footer>
	<script src="/javascripts/slash.js"></script>





<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6776456-2', 'willi.am');
  ga('send', 'pageview');

</script>

</body>
</html>