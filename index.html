
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Will Anderson</title>
	<meta name="author" content="Will Anderson">

	
	<meta name="description" content="If you ever need to inspect Git traffic to diagnose problems, or are just curious about the internal workings of Git, it&rsquo;s pretty easy to make &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Will Anderson" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">Will Anderson</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/plugins">WordPress Plugins</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/plugins">WordPress Plugins</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:willi.am">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/itsananderson" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/itsananderson" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="https://www.google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:willi.am">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/05/08/inspecting-git-traffic-in-fiddler/">
		
			Inspecting Git Traffic in Fiddler</a>
	</h2>
	<div class="entry-content">
		<p>If you ever need to inspect Git traffic to diagnose problems, or are just curious about the internal workings of Git, it&rsquo;s pretty easy to make Git send traffic through Fiddler.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git config --global http.proxy 127.0.0.1:8888
</span><span class='line'>git config --global http.sslVerify false</span></code></pre></td></tr></table></div></figure>


<p>This tells Git to use Fiddler as the proxy, and to turn off SSL certificate verification (so it doesn&rsquo;t balk at Fiddler&rsquo;s cert).</p>

<p>Make sure Fiddler&rsquo;s actually running, or Git won&rsquo;t be able to connect.</p>

<p>If you just want to use Fiddler for a single repository, run the commands from within that repository without the <code>--global</code> flag. Obviously this work for the <code>git clone</code> command, so you&rsquo;ll have to use a global configuration if you want to inspect that.</p>

<p>When you&rsquo;re done, make sure you undo your changes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git config --global --unset http.proxy
</span><span class='line'>git config --global --unset http.sslVerify</span></code></pre></td></tr></table></div></figure>


<p>Again, remove the <code>--global</code> flag if you&rsquo;re just inspecting traffic for a single repository.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-05-08T07:32:26-07:00" pubdate data-updated="true">May 8<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/fiddler/'>Fiddler</a>, <a class='category' href='/blog/categories/git/'>Git</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/05/07/running-express-4-sites-on-azure/">
		
			Running Express 4 Sites on Azure</a>
	</h2>
	<div class="entry-content">
		<p>If you&rsquo;ve created an Express 4 app with the new scaffold utility recently, you may have noticed that it doesn&rsquo;t work in Azure. When you try to load the site, it fails with the following error:</p>

<blockquote><p>The page cannot be displayed because an internal server error has occurred.</p></blockquote>

<h2>The Diagnosis</h2>

<p>This is because of the new structure Express creates for its apps. Instead of app.js being the expected entry point, Express now specifies bin/www as the entry point for starting the server.</p>

<p>I suspect the reason for this is so that the newly scaffolded app can be consumed as a module, allowing the consumer to worry about port binding etc. Unfortunately, this causes problems for Azure.</p>

<p>When Azure starts a Node.js site, it looks for either a server.js or an app.js. As far as I can tell from my admittedly limited testing, it doesn&rsquo;t seem look at package.json for an alternate entry point. Because of this, when it includes app.js, nothing ever binds to the listening port, so the app immediately exits on startup.</p>

<h2>The Workaround</h2>

<p>Since Azure first looks for a server.js file when it starts a site, the easiest solution I&rsquo;ve found is to add a <code>server.js</code> file with the following contents.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./bin/www&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, when Azure starts your site, it will require server.js, which will require bin/www, which will require app.js. After that somewhat convoluted redirection chain, all will again be right in the world.</p>

<p>The Azure documentation has an <a href="http://azure.microsoft.com/en-us/documentation/articles/cloud-services-nodejs-develop-deploy-express-app/">alternative workaround</a> (see steps 4 and 5 of &ldquo;Install Express&rdquo;), but I don&rsquo;t care for it.
The problem with their solution is that it duplicates the code from bin/www into server.js, which means any updates you make to bin/www will also need to be applied to server.js.
Long story short, code duplication sucks.</p>

<h2>The Solution</h2>

<p>There are a couple of things that would properly solve this problem instead of just working around it.</p>

<h3>Express Scaffold Fix</h3>

<p>There are probably a few ways Express could fix this, but the simplest I can think of would be to add a server.js that does the same thing as my workaround.
If that&rsquo;s not desirable for all sites, they could add a &ldquo;Azure compatibility&rdquo; flag that explicitly adds the sever.js workaround.</p>

<h3>Azure Fix</h3>

<p>In my oppinion, Azure should have a way to specify the entry-point in package.json rather than hardcoding to app.js and server.js.</p>

<p>The conventional <code>npm start</code> configuration is a logical place to begin, since it&rsquo;s a <a href="https://www.npmjs.org/doc/misc/npm-scripts.html">supported spec from npm</a>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>    "scripts": {
</span><span class='line'>        "start" : "&lt;path&gt;"
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Azure relies on iisnode, which probably can&rsquo;t consume package.json directly.
However, Azure could look at a setting in package.json during the site setup process (when it does stuff like package restore), and configure web.config, just like it does now to switch between app.js and server.js.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-05-07T06:57:05-07:00" pubdate data-updated="true">May 7<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/azure/'>Azure</a>, <a class='category' href='/blog/categories/express/'>Express</a>, <a class='category' href='/blog/categories/node/'>Node</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/05/06/git-for-devs-who-cant-commit-good/">
		
			Git for Devs Who Can&#8217;t Commit Good</a>
	</h2>
	<div class="entry-content">
		<p>Two big Git mantras are &ldquo;Commit early, commit often&rdquo; and &ldquo;Branches are cheap&rdquo;.</p>

<p>When I started using Git, I had these ideas in the back of my mind.
Unfortunately, I only really thought of them after I&rsquo;d done a huge chunk of work without committing any code.
I&rsquo;d type <code>git status</code> or <code>git diff</code> and scroll through my changes, but I&rsquo;d eventually admit defeat and commit everything.
I&rsquo;d promise to commit more frequently &ldquo;next time&rdquo;, but it never seemed to happen.</p>

<p>Frequent committing is something that you learn as a way to avoid pain.
In a typical chunk of dev time, it&rsquo;s not uncommon to make a sweeping change, and then realize that the change was a bad decision.
Without commit history, the only way to get back the previous version is to rely on your editor&rsquo;s undo function.
This causes problems when you have a mix of changes that you want to keep and changes that you want to undo.
Frequent, small commits can make it easier to jump pack to specific points.</p>

<p><img class="center" src="/images/post-images/commit-for-ants.jpg"></p>

<h2>Creating Good Commits</h2>

<p>In addition to committing frequently, it&rsquo;s important to make good commits.
There are several important features aspects in a good commit.</p>

<h3>Good Commit Messages</h3>

<p>Writing a good commit message takes more than avoiding &ldquo;did stuff&rdquo; messages.</p>

<p>A good commit message is a love note to your future self, or anyone else who works on your code.
A bad commit message is more of a suicide note.</p>

<p>A technique I picked up from <a href="http://davidruttka.com/">David</a>, one of my coworkers, is to do commit messages along the lines of the following:</p>

<pre><code>&lt;short summary of changes in imperative voice&gt;

&lt;longer paragraph describing the change&gt;

Fixes/Implements: #&lt;issue or feature number&gt;

Before:
&lt;description of problem you are fixing or feature you are implementing&gt;

After:
&lt;how it behaves now that your change is applied&gt;

How I Tested It:
&lt;description of any unit tests, functional tests, or manual tests you ran to test this change&gt;
</code></pre>

<p>This may seem verbose, but it really doesn&rsquo;t take long, and it gives you a huge advantage if you ever have to come back and figure out what this commit was all about.</p>

<p>This doesn&rsquo;t apply to every change.
If you&rsquo;re fixing a typo in a comment, or adding a missing semicolon to your JavaScript, you can probably get away with a one line commit message.</p>

<p>A good rule of thumb is that a competent dev should be able to look at your commit message and (approximately) duplicate your work without looking at the code.</p>

<p>Finally, your summary line should be written in imperative voice.
&ldquo;Make changes&rdquo; not &ldquo;Made changes&rdquo; or &ldquo;Making changes&rdquo;.
This guarantees that your messages will mesh with Git&rsquo;s auto-generated messages for things like <code>revert</code> and <code>merge</code>.
It also makes it clear that you&rsquo;re talking about what this commit does, not what previous or future commits are doing.</p>

<p>For more thoughts on commit messages, see <a href="http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html">A Note About Git Commit Messages</a>.</p>

<h3>The Right Files</h3>

<p>It&rsquo;s tempting to use a <code>-a</code> flag to commit all pending changes, but in most cases you should put more thought into what files you include in a commit.</p>

<p>Consider an example.
Say you add a feature in file <code>a.js</code>, but in the process, you discover a typo in <code>b.js</code>.
It&rsquo;s tempting to commit both changes as one, because the typo fix is so small, but consider what happens if you later need to revert your commit.
Not only will you be reverting your feature, but you&rsquo;ll also be reverting the typo fix. This means you&rsquo;ll need to do a second commit to re-fix the typo change.
If you instead do two distinct commits, you can safely undo the problematic feature without touching the typo fix.</p>

<p>Of course, this doesn&rsquo;t mean you have to add each file individually.
There are many handy shortcuts for adding exactly the files you intend.</p>

<p><code>git add file1 file2 file3</code> &ndash; Adds multiple files in one command</p>

<p><code>git add folder/</code> &ndash; Adds all changes under a folder</p>

<p><code>git add .</code> &ndash; Stages all modified and new files in the current folder</p>

<p><code>git add -A .</code> &ndash; Stages all modifed and new files as well as staging any deleted files in the current folder</p>

<p><code>git add '*.txt'</code> &ndash; Recursively adds all files ending in .txt</p>

<p><code>git add *.txt</code> &ndash; Adds all files <em>in the current folder</em> ending in .txt</p>

<p>This approach doesn&rsquo;t just apply to different files.
What if you add a feature and fix a typo in the same file?<br/>
Fortunately, <code>git add -p</code> makes it easy to <a href="http://www.benhallbenhall.com/2013/01/git-add-p-patches-full-commits/">only stage parts of files</a>.</p>

<p>If you &ldquo;add&rdquo; (or stage) a file that you don&rsquo;t want to commit, it&rsquo;s easy to remove.
Just run <code>git reset HEAD &lt;file&gt;</code>.</p>

<p>Using these techniques, you can create concise, cohesive, good looking commits.
Your future self will thank you.</p>

<p><img class="center" src="/images/post-images/good-looking-commits.jpg"></p>

<h2>Learning to Do Other Stuff Good Too</h2>

<p>There are a number of other techniques for creating a useful commit history.
Here are some that I&rsquo;ve found especially useful.</p>

<p><strong>NOTE</strong>: Only use these techniques if you haven&rsquo;t shared your changes.
If you&rsquo;ve already pushed your changes, ammending your commit can cause problems for other collaborators on your project</p>

<h3>Fixing a Commit</h3>

<p>One of the great features of Git is the ability to rewrite history.
The simplest way to do that is with the <code>git commit --amend</code> command.
This will take your current staged changes and apply them to the previous commit, &ldquo;ammending&rdquo; it.
You&rsquo;ll also get a chance to change the commit message.</p>

<p>This is useful for in a number of cases:</p>

<ul>
<li>You make a commit and forgot to add a file</li>
<li>You missed adding a part of a file</li>
<li>You had a typo in one of your changes</li>
<li>You had a typo, or missing information in your commit message</li>
</ul>


<h3>Squashing Commits</h3>

<p>Sometimes you&rsquo;ll have silly commits like &ldquo;forgot a file&rdquo;, and you don&rsquo;t need them to be distinct.
For the sake of your commit history, it can be good to flatten those commits.
This allows you to pretend that you never make any mistakes :)</p>

<p>Consider the following log</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>8fb97b5 Implement bla bla 
</span><span class='line'>
</span><span class='line'>bb0ee77 Address feedback
</span><span class='line'>
</span><span class='line'>bf582d6 Implement foo foo
</span><span class='line'>
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>If your changes from <code>Address feedback</code> are just cleanups to <code>Implement foo foo</code>, you probably don&rsquo;t need that extra commit sitting in your commit history.</p>

<p>I could walk through the process of rebasing, but there&rsquo;s already a pretty thorough tutorial on <a href="http://gitready.com/advanced/2009/02/10/squashing-commits-with-rebase.html">squashing commits with rebase</a></p>

<h2>In Conclusion</h2>

<p>Making throughful, atomic, thoroughly commented commits takes some practice, but it&rsquo;s totally worth it.</p>

<p>In the next couple weeks, I plan to write some follow-up posts that cover other techniques for managing your commit history.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-05-06T13:50:34-07:00" pubdate data-updated="true">May 6<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/git/'>Git</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/04/08/a-lesson-in-debugging-verify-your-tools/">
		
			A Lesson in Debugging: Verify Your Tools</a>
	</h2>
	<div class="entry-content">
		<p>This is a cautionary tale</p>

<p>Yesterday I wasted a day of dev time.
Worse than that, I was pairing with <a href="http://www.davidruttka.com/">two</a> of my <a href="http://msarchet.com/">co-workers</a> most of the day, so in the end we wasted about 2.5 days of dev time.</p>

<p>We spent the day debugging an &ldquo;off by one (and sometimes two)&rdquo; error.</p>

<p>David, one of my coworkers, <a href="http://www.davidruttka.com/blog/2014/04/09/principles-of-debugging-a-postmortem/">also blogged this experience</a>.
It&rsquo;s an entertaining read.
Check it out.</p>

<h2>The Problem</h2>

<p>The bug seemed simple.
They always do.
When you requested something by Id from our API, it returned with almost valid data.
Except that the Id property in the JSON (a long) was frequently incremented or decremented by 1 or 2.</p>

<p>We originally saw the issue in an Angular app.
We were suspicious about potential JavaScript numeric issues, so of course we opened up Fiddler to get at the &ldquo;real&rdquo; data</p>

<h2>The Fiddler Inspection</h2>

<p>When we inspected the requests in Fiddler and looked at the JSON viewer, same &ldquo;off by [1-2]&rdquo; issue.
In our minds, this confirmed that Angular and JavaScript weren&rsquo;t the issue.</p>

<p>After going through the &ldquo;disable stuff until it works&rdquo; process with our API, we were still seeing the same problem.
The only thing that fixed the issue was having Fiddler request XML instead of JSON. &ldquo;Ahh&rdquo;, we thought, &ldquo;The issue must be with our JSON serializer&rdquo;</p>

<h2>Checking the Serializer</h2>

<p>We spent a few minutes in LINQPad performing serializations with Json.NET, duplicating the problematic object as closely as possible.
The object serialized without issue, which confirmed in our minds that Json.NET does not, in fact, mangle long values during serialization</p>

<h2>The Reduction</h2>

<p>We decided to build a reduction by creating an empty WebApi project and adding components until we reproduced the issue.
We added a dummy controller that returns an object identical to the one with the serialization issues.
We opened the new URL in the browser, and the serialization issues weren&rsquo;t there.
We should have checked the reduction in Fiddler, but we didn&rsquo;t.</p>

<h2>Patterns Emerge</h2>

<p>Early on in our debugging session, I noticed that even Ids either remained unchanged or incremented/decremented by two.
Odd Ids, on the other hand, always either incremented or decremented by one.</p>

<p>I initially identified a simplified version of that pattern where even Ids don&rsquo;t change, so when counter-examples emerged, I abandoned the search for a pattern.</p>

<p>As the afternoon wore on, we decided to generate a consecutive sequence of Ids to see if we could identify a pattern.
What we discovered is that for large Ids, the numbers began &ldquo;snapping&rdquo; to multiples of four.
Small Ids (like, say, 207) didn&rsquo;t change.</p>

<h2>The Final Puzzle Piece</h2>

<p>While David spun a series of object serializations through LINQPad, I began combining keywords in Bing to see if I could find anyone else with the same issue.</p>

<p>Around the time David realized that LINQPad was spitting out serialized Ids with correct values, I discovered <a href="http://stackoverflow.com/questions/6571339/how-to-correctly-serialize-c-sharp-long-number-using-controllers-json-method-in">this StackOverflow post on &ldquo;correctly&rdquo; serializing longs</a>.
As the answer explains, JavaScript doesn&rsquo;t have longs.
All numbers are 64 bit floats.
We&rsquo;d considered this, but had dismissed it because Fiddler was showing the same issue.</p>

<p>Then it hit me.
Fiddler is written in JScript, which means it has the same 64 bit float limitations.</p>

<p>By implicitly trusting Fiddler&rsquo;s JSON viewer, we assumed the problem was incorrect data coming from our server.
When we finally looked at the raw data in Fiddler, we saw that the correct Ids were coming across the wire.
Fiddler&rsquo;s JSON viewer was parsing the long into a 64 bit float and tossing away the last 2 bits, which effectively &ldquo;snapped&rdquo; all Ids to multiples of 4.</p>

<p>The problem wasn&rsquo;t with our API directly.
The problem was the way JavaScript and JScript handle large numbers.</p>

<h2>Lesson Learned</h2>

<p>When debugging an issue like this, look at the raw data.
Not some data viewer over the data.
The <em>raw</em> data</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-04-08T08:10:41-07:00" pubdate data-updated="true">Apr 8<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/debugging/'>Debugging</a>, <a class='category' href='/blog/categories/fiddler/'>Fiddler</a>, <a class='category' href='/blog/categories/javascript/'>JavaScript</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/04/07/understanding-vim-command-line-and-search-history/">
		
			Understanding Vim Command Line and Search History</a>
	</h2>
	<div class="entry-content">
		<p>If you&rsquo;re a Vim user like me, you&rsquo;ve likely found yourself staring at a view like this and wondered:</p>

<h4>&ldquo;How&rsquo;d I get here, and how do I get away&rdquo;</h4>

<p><img src="/images/post-images/vim-command-line-history.png"></p>

<p>Don&rsquo;t dispair. You&rsquo;ve discovered Vim&rsquo;s command line history. This is the list of commands you&rsquo;ve run. They&rsquo;re stored in <code>~/.viminfo</code> or <code>~/_viminfo</code>, depending on your system configuration</p>

<p>There are actually two modes you can get into:
Command Line History, and Search History.
We&rsquo;ll cover both</p>

<p>If you didn&rsquo;t want to get into your command/search history, you can easily get back to normal mode by hitting <code>CTRL+C</code> twice</p>

<h2>Command Line History</h2>

<p>Command line history is activated by typing <code>q:</code>. I usually find myself in this mode after trying to type <code>:q</code> too quickly</p>

<p>This is actually a pretty useful tool.
You&rsquo;re basically opening a file that contains your command history, so you can treat it like you would a file you have opened in Vim.</p>

<p>Start by navigating through the commands.</p>

<ul>
<li>You can use <code>j</code> and <code>k</code> to move down and up.</li>
<li>You can search through the commands with <code>/&lt;searchtext&gt;</code></li>
</ul>


<p>Once you find the command you want to run, simply hit <code>ENTER</code> from &ldquo;Normal&rdquo; mode to run that command on the current file</p>

<h2>Search History</h2>

<p>Search history is activated by typing <code>q/</code>.</p>

<p>This is also a useful tool, though not as useful as command line history, in my opinion</p>

<p>Just like command line history, you can navigate through the history just like a regular file, and hit <code>ENTER</code> with the cursor over the desired search to perform that search on the current document</p>

<h2>Now You&rsquo;re Better at Vim</h2>

<p>When I figured out what these views meant, it took a scary &ldquo;how do I get out of this mode&rdquo; moment, and turned it into a &ldquo;this is useful&rdquo; moment.
Hopefully after reading this post, you&rsquo;ll feel the same way!</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-04-07T22:48:12-07:00" pubdate data-updated="true">Apr 7<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/vim/'>Vim</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/03/30/hello-octopress/">
		
			Hello, Octopress!</a>
	</h2>
	<div class="entry-content">
		<p>After <a href="https://twitter.com/druttka">David</a> wrote <a href="http://www.davidruttka.com/blog/2014/03/29/moving-from-wordpress-to-github-pages-using-jekyll-via-octopress/">these</a> nice <a href="http://www.davidruttka.com/blog/2014/03/29/setting-up-octopress-for-github-pages/">blog posts</a> at my request, I figured I should probably give Octopress the old college try.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-03-30T09:48:36-07:00" pubdate data-updated="true">Mar 30<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/blogging/'>Blogging</a>, <a class='category' href='/blog/categories/octopress/'>Octopress</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/03/29/testing-whether-an-npm-module-is-installed/">
		
			Testing Whether an NPM Module Is Installed</a>
	</h2>
	<div class="entry-content">
		<p>Node doesn&rsquo;t have a well documented way of checking whether a module is available.
This is usually fine. You just include a package.json in your project, and expect people to run <code>npm install</code>.
This is how most popular Node frameworks work.</p>

<p>But what if you have a devDependency entry that you want to include only if it is installed?
I searched for an answer and didn&rsquo;t find anything conclusive, so I&rsquo;m documenting what I <em>did</em> find in case I forget later.</p>

<p>Buried in NPM&rsquo;s package.json documentation is <a href="https://www.npmjs.org/doc/json.html#optionalDependencies">an example</a>
for handling a package that may or may not be installed. In short, you use a try/catch. Here&rsquo;s an example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">program</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">try</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">program</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;commander&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Any code to run if this module doesn&#39;t exist</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nx">program</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">program</span><span class="p">.</span><span class="nx">version</span><span class="p">(</span><span class="s1">&#39;0.0.1&#39;</span><span class="p">)</span> <span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;-n, --name[name]&#39;</span><span class="p">,</span> <span class="s1">&#39;Your name&#39;</span><span class="p">)</span>
</span><span class='line'>         <span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-03-29T10:12:23-07:00" pubdate data-updated="true">Mar 29<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/npm/'>NPM</a>, <a class='category' href='/blog/categories/node/'>Node</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/02/07/pass-dynamic-flags-to-nuget-with-powershell-splatting/">
		
			Pass Dynamic Flags to NuGet With PowerShell Splatting</a>
	</h2>
	<div class="entry-content">
		<p>While working on a PowerShell script for packaging multiple NuGet packages, I discovered a peculiarity in calling NuGet with PowerShell splatting. I wanted to do something like the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="k">Function</span> <span class="n">Package-Project</span><span class="p">(</span>
</span><span class='line'>    <span class="no">[string]</span><span class="nv">$folder</span><span class="p">,</span>
</span><span class='line'>    <span class="no">[switch]</span><span class="nv">$build</span><span class="p">,</span>
</span><span class='line'>    <span class="no">[switch]</span><span class="nv">$symbols</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">pushd</span> <span class="nv">$folder</span>
</span><span class='line'>    <span class="nv">$nugetArgs</span> <span class="p">=</span> <span class="err">@</span><span class="p">{</span><span class="n">Properties</span><span class="p">=</span><span class="s2">&quot;Configuration=$configuration&quot;</span><span class="p">}</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nv">$build</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$nugetArgs</span><span class="p">.</span><span class="n">Build</span><span class="p">=</span><span class="nv">$True</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nv">$symbols</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$nugetArgs</span><span class="p">.</span><span class="n">Symbols</span><span class="p">=</span><span class="nv">$True</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">nuget</span> <span class="n">pack</span> <span class="nv">@nugetArgs</span>
</span><span class='line'>    <span class="n">popd</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">Package-Project</span> <span class="n">ProjectA</span>
</span><span class='line'><span class="n">Package-Project</span> <span class="n">ProjectB</span>
</span></code></pre></td></tr></table></div></figure>


<p>Even though I&rsquo;ve &ldquo;Splatted&rdquo; $nugetArgs into my NuGet call, the way NuGet handles arguments causes it to choke on the
HashSet of arguments, and throw an error like the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>nuget : Unknown option: &#39;-Build:True&#39;
</span><span class='line'>At line:1 char:38
</span><span class='line'>+ nuget pack $project $nugetArgs
</span><span class='line'>+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span><span class='line'>    + CategoryInfo          : NotSpecified: (Unknown option: &#39;-Build:True&#39;:String) [], RemoteException
</span><span class='line'>    + FullyQualifiedErrorId : NativeCommandError
</span></code></pre></td></tr></table></div></figure>


<p>Digging into the <a href="http://nuget.codeplex.com/SourceControl/latest#src/CommandLine/CommandLineParser.cs">source code</a>,
I found that they have a pretty customized argument parser, which seems to make passing a HashSet pretty much impossible.
(If I&rsquo;m wrong, leave a comment!)</p>

<p>Fortunately, there&rsquo;s a <em>fairly</em> reasonable workaround: Pass an array of arguments rather than a HashSet:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="k">Function</span> <span class="n">Package-Project</span><span class="p">(</span>
</span><span class='line'>    <span class="no">[string]</span><span class="nv">$folder</span><span class="p">,</span>
</span><span class='line'>    <span class="no">[switch]</span><span class="nv">$build</span><span class="p">,</span>
</span><span class='line'>    <span class="no">[switch]</span><span class="nv">$symbols</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">pushd</span> <span class="nv">$folder</span>
</span><span class='line'>    <span class="nv">$nugetArgs</span> <span class="p">=</span> <span class="s2">&quot;-Properties&quot;</span><span class="p">,</span> <span class="s2">&quot;Configuration=$configuration&quot;</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nv">$build</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$nugetArgs</span> <span class="p">+=</span> <span class="s2">&quot;-Build&quot;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nv">$symbols</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$nugetArgs</span> <span class="p">+=</span> <span class="s2">&quot;-Symbols&quot;</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">nuget</span> <span class="n">pack</span> <span class="nv">@nugetArgs</span>
</span><span class='line'>    <span class="n">popd</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">Package-Project</span> <span class="n">ProjectA</span>
</span><span class='line'><span class="n">Package-Project</span> <span class="n">ProjectB</span>
</span></code></pre></td></tr></table></div></figure>


<p>So there you have it. Use a list of parameter names and values rather than a HashSet when dynamically invoking NuGet.
This is actually somewhat intuitive from a classic CMD standpoint, but not so much from a PowerShell perspective.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-02-07T09:24:32-08:00" pubdate data-updated="true">Feb 7<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/nuget/'>NuGet</a>, <a class='category' href='/blog/categories/powershell/'>Powershell</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/12/03/using-controller-as-syntax-in-angular-routes/">
		
			Using &#8220;Controller as&#8221; Syntax in Angular Routes</a>
	</h2>
	<div class="entry-content">
		<p>I&rsquo;ve been using the new &ldquo;Controller as&rdquo; syntax in Angular for a few months, but today I realized I didn&rsquo;t know how to use
the syntax for route controllers. After spending a few minutes scratching my head and &ldquo;Googling with Bing&rdquo;, I figured it out.
The $routeProvider supports a &ldquo;controllerAs&rdquo; property for routes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$routeProvider</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;Views/Home/Index.html&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">controller</span><span class="o">:</span> <span class="s1">&#39;HomeCtrl&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">controllerAs</span><span class="o">:</span> <span class="s1">&#39;vm&#39;</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>    <span class="p">.</span><span class="nx">otherwise</span><span class="p">({</span> <span class="nx">redirectTo</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span> <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s it. Not very complicated, but hopefully it will save someone a few minutes of research.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-12-03T09:33:58-08:00" pubdate data-updated="true">Dec 3<span>rd</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/angular/'>Angular</a>, <a class='category' href='/blog/categories/javascript/'>JavaScript</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2013/10/09/creating-an-angular-markdown-preview/">
		
			Creating an Angular Markdown Preview</a>
	</h2>
	<div class="entry-content">
		<p>I&rsquo;ve been exploring <a href="http://angularjs.org/" title="Angular Project Homepage">Angular</a> over the last few months, and I really like the way it works.</p>

<p>Because I like to use <a href="http://en.wikipedia.org/wiki/Markdown">Markdown</a> for things like my dev journal, I have been wanting to implement my own Markdown preview tool that I could customize to work just the way I want. When I first started learning Angular, I decided to see how easy it would be to write an Angular Markdown preview tool using Angular. Turns out it&rsquo;s super simple.</p>

<p>If you&rsquo;d rather skip straight to the demo, you can <a href="http://itsananderson.azurewebsites.net/markdown">view the finished markdown preview</a>.</p>

<p>I won&rsquo;t go into great detail about the purpose of Angular, since it&rsquo;s readily available elsewhere. In this project, I just wanted a simple way to bind to a textbox so that I could update an HTML Markdown preview. Angular&rsquo;s declarative binding makes it an excellent choice for this.</p>

<h3>Rendering an Angular Markdown Preview</h3>

<p>Since I didn&rsquo;t want to write my own markdown converter, I decided to look for an existing one. I quickly settled on this <a href="https://npmjs.org/package/markdown">markdown npm package</a>. I installed the package, then moved the converter code into my &lsquo;lib/js&rsquo; folder so that it would be accessible from my web app.</p>

<p>To make the front-end as simple as possible, I decided to <a href="http://docs.angularjs.org/guide/dev_guide.templates.filters.creating_filters">create an Angular filter</a> to provide the conversion from Markdown to HTML.</p>

<p>The code is pretty simple. The markdown npm package adds a &ldquo;markdown&rdquo; object to the &ldquo;window&rdquo; global, so it&rsquo;s easy to access the converter.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;markdown&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">text</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="k">return</span> <span class="nx">markdown</span><span class="p">.</span><span class="nx">toHTML</span><span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="nx">text</span><span class="p">));</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Update</strong> 4/25/14: In newer versions of Angular you&rsquo;ll need to include <code>angular-sanitize.js</code> on the page, and bind with the <code>ng-bind-html</code> attribute. Props to <a href="https://twitter.com/michaeldick">Dick</a> and <a href="http://konpa.fr">Julien</a> for pointing this out.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-10-09T17:56:26-07:00" pubdate data-updated="true">Oct 9<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/angular/'>Angular,</a>, <a class='category' href='/blog/categories/javascript/'>JavaScript,</a>, <a class='category' href='/blog/categories/markdown/'>Markdown</a>


</div>
	
</div>
</article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2014

    Will Anderson

</footer>
	<script src="/javascripts/slash.js"></script>





<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6776456-2', 'willi.am');
  ga('send', 'pageview');

</script>
</body>
</html>